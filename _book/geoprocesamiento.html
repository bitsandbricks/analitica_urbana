<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 2 Geoprocesamiento | Analítica Urbana</title>
  <meta name="description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 2 Geoprocesamiento | Analítica Urbana" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 2 Geoprocesamiento | Analítica Urbana" />
  
  <meta name="twitter:description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  

<meta name="author" content="Antonio Vazquez Brust &amp; Angie Scetta" />


<meta name="date" content="2020-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analítica Urbana</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>¿Para quién es esto?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#antes-de-empezar"><i class="fa fa-check"></i>Antes de empezar</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#sobre-la-analítica-urbana"><i class="fa fa-check"></i><b>1.1</b> Sobre la analítica urbana</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html"><i class="fa fa-check"></i><b>2</b> Geoprocesamiento</a><ul>
<li class="chapter" data-level="2.1" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#cruces-espaciales"><i class="fa fa-check"></i><b>2.1</b> Cruces espaciales</a></li>
<li class="chapter" data-level="2.2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#dataframes-tradicionales-y-dataframes-espaciales"><i class="fa fa-check"></i><b>2.2</b> Dataframes tradicionales y dataframes espaciales</a><ul>
<li class="chapter" data-level="2.2.1" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#combinando-datasets-con-información-espacial"><i class="fa fa-check"></i><b>2.2.1</b> Combinando datasets con información espacial</a></li>
<li class="chapter" data-level="2.2.2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#coropletas"><i class="fa fa-check"></i><b>2.2.2</b> Coropletas</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#uniones"><i class="fa fa-check"></i><b>2.3</b> Uniones</a></li>
<li class="chapter" data-level="2.4" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#intersecciones"><i class="fa fa-check"></i><b>2.4</b> Intersecciones</a></li>
<li class="chapter" data-level="2.5" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#distancias"><i class="fa fa-check"></i><b>2.5</b> Distancias</a></li>
<li class="chapter" data-level="2.6" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#cálculo-de-extensión-longitud-área"><i class="fa fa-check"></i><b>2.6</b> Cálculo de extensión (longitud, área)</a></li>
<li class="chapter" data-level="2.7" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#ejercicios"><i class="fa fa-check"></i><b>2.7</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><i class="fa fa-check"></i><b>3</b> Acceso a información urbana georeferenciada en repositorios <em>online</em></a><ul>
<li class="chapter" data-level="3.1" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#openstreetmap-desde-r"><i class="fa fa-check"></i><b>3.1</b> OpenStreetMap desde R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#definiendo-el-lugar"><i class="fa fa-check"></i><b>3.1.1</b> Definiendo el lugar</a></li>
<li class="chapter" data-level="3.1.2" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#extrayendo-información-de-openstreetmap"><i class="fa fa-check"></i><b>3.1.2</b> Extrayendo información de OpenStreetMap</a></li>
<li class="chapter" data-level="3.1.3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#visualizando-los-resultados"><i class="fa fa-check"></i><b>3.1.3</b> Visualizando los resultados</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#un-ejercicio-más-bares-en-el-barrio"><i class="fa fa-check"></i><b>3.2</b> Un ejercicio más: ¡Bares en el barrio!</a></li>
<li class="chapter" data-level="3.3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#ejercicios-1"><i class="fa fa-check"></i><b>3.3</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html"><i class="fa fa-check"></i><b>4</b> Obteniendo y analizando datos de redes sociales</a><ul>
<li class="chapter" data-level="4.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#investigando-con-social-media"><i class="fa fa-check"></i><b>4.1</b> Investigando con social media</a><ul>
<li class="chapter" data-level="4.1.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#los-desafíos-de-trabajar-con-información-de-repositorios-sociales"><i class="fa fa-check"></i><b>4.1.1</b> Los desafíos de trabajar con información de repositorios sociales</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#conectando-r-a-twitter"><i class="fa fa-check"></i><b>4.2</b> Conectando R a Twitter</a><ul>
<li class="chapter" data-level="4.2.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#obteniendo-autorización"><i class="fa fa-check"></i><b>4.2.1</b> Obteniendo autorización</a></li>
<li class="chapter" data-level="4.2.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#acceso-a-twitter-via-r-el-paquete-rtweet"><i class="fa fa-check"></i><b>4.2.2</b> Acceso a Twitter via R: el paquete <em>rtweet</em></a></li>
<li class="chapter" data-level="4.2.3" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#usuarios-más-populares"><i class="fa fa-check"></i><b>4.2.3</b> Usuarios más populares</a></li>
<li class="chapter" data-level="4.2.4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#tweets-más-populares"><i class="fa fa-check"></i><b>4.2.4</b> Tweets más populares</a></li>
<li class="chapter" data-level="4.2.5" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#la-hora-del-día-a-la-que-se-producen-los-tweets"><i class="fa fa-check"></i><b>4.2.5</b> La hora del día a la que se producen los tweets</a></li>
<li class="chapter" data-level="4.2.6" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#procedencia-de-los-usuarios"><i class="fa fa-check"></i><b>4.2.6</b> Procedencia de los usuarios</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#escuchando-tweets-en-tiempo-real"><i class="fa fa-check"></i><b>4.3</b> Escuchando tweets en tiempo real</a></li>
<li class="chapter" data-level="4.4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#capturando-tweets-por-períodos-prolongados"><i class="fa fa-check"></i><b>4.4</b> Capturando tweets por períodos prolongados</a></li>
<li class="chapter" data-level="4.5" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#capturando-tweets-en-zonas-específicas"><i class="fa fa-check"></i><b>4.5</b> Capturando tweets en zonas específicas</a><ul>
<li class="chapter" data-level="4.5.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#extraer-las-coordenadas"><i class="fa fa-check"></i><b>4.5.1</b> Extraer las coordenadas</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#visualizando-los-datos-georeferenciados"><i class="fa fa-check"></i><b>4.6</b> Visualizando los datos georeferenciados</a><ul>
<li class="chapter" data-level="4.6.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#mapas-estáticos-con-ggmap"><i class="fa fa-check"></i><b>4.6.1</b> Mapas estáticos con ggmap</a></li>
<li class="chapter" data-level="4.6.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#mapas-interactivos-con-leaflet"><i class="fa fa-check"></i><b>4.6.2</b> Mapas interactivos con leaflet</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#ejercicios-2"><i class="fa fa-check"></i><b>4.7</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html"><i class="fa fa-check"></i><b>5</b> Analizando dinámicas espacio-temporales</a><ul>
<li class="chapter" data-level="5.0.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#trabajando-con-fechas"><i class="fa fa-check"></i><b>5.0.1</b> Trabajando con fechas</a></li>
<li class="chapter" data-level="5.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#mirando-al-espacio"><i class="fa fa-check"></i><b>5.1</b> Mirando al espacio</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#obteniendo-un-mapa-base"><i class="fa fa-check"></i><b>5.1.1</b> Obteniendo un mapa base</a></li>
<li class="chapter" data-level="5.1.2" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#de-coordenadas-al-mapa"><i class="fa fa-check"></i><b>5.1.2</b> De coordenadas al mapa</a></li>
<li class="chapter" data-level="5.1.3" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#mapas-de-densidad"><i class="fa fa-check"></i><b>5.1.3</b> Mapas de densidad</a></li>
<li class="chapter" data-level="5.1.4" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#visualizando-multiples-categorías"><i class="fa fa-check"></i><b>5.1.4</b> Visualizando multiples categorías</a></li>
<li class="chapter" data-level="5.1.5" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#combinando-espacio-y-tiempo"><i class="fa fa-check"></i><b>5.1.5</b> Combinando espacio y tiempo</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#ejercicios-3"><i class="fa fa-check"></i><b>5.2</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><i class="fa fa-check"></i><b>6</b> Analizando movimiento: el flujo de viajes urbanos</a><ul>
<li class="chapter" data-level="6.1" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#estimando-rutas"><i class="fa fa-check"></i><b>6.1</b> Estimando rutas</a></li>
<li class="chapter" data-level="6.2" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#cuantificando-interacción"><i class="fa fa-check"></i><b>6.2</b> Cuantificando interacción</a></li>
<li class="chapter" data-level="6.3" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#estimando-rutas-1"><i class="fa fa-check"></i><b>6.3</b> Estimando rutas</a></li>
<li class="chapter" data-level="6.4" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#extra-cómo-obtener-las-rutas-de-todos-los-recorridos"><i class="fa fa-check"></i><b>6.4</b> EXTRA: Cómo obtener las rutas de todos los recorridos</a></li>
<li class="chapter" data-level="6.5" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#ejercicios-4"><i class="fa fa-check"></i><b>6.5</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html"><i class="fa fa-check"></i><b>7</b> Machine Learning (en una aplicación urbana)</a><ul>
<li class="chapter" data-level="7.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-0-cargar-paquetes"><i class="fa fa-check"></i><b>7.1</b> Paso 0: Cargar paquetes</a></li>
<li class="chapter" data-level="7.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-1-cargar-los-datos"><i class="fa fa-check"></i><b>7.2</b> Paso 1: Cargar los datos</a></li>
<li class="chapter" data-level="7.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-2-examinar-los-datos"><i class="fa fa-check"></i><b>7.3</b> Paso 2: Examinar los datos</a></li>
<li class="chapter" data-level="7.4" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-3-limpiar-los-datos"><i class="fa fa-check"></i><b>7.4</b> Paso 3: Limpiar los datos</a><ul>
<li class="chapter" data-level="7.4.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#imputar-valores-faltantes"><i class="fa fa-check"></i><b>7.4.1</b> Imputar valores faltantes</a></li>
<li class="chapter" data-level="7.4.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#codificar-variables-categóricas"><i class="fa fa-check"></i><b>7.4.2</b> Codificar variables categóricas</a></li>
<li class="chapter" data-level="7.4.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#unificar-la-escala-de-las-variables-numéricas"><i class="fa fa-check"></i><b>7.4.3</b> Unificar la escala de las variables numéricas</a></li>
<li class="chapter" data-level="7.4.4" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#consolidar-todas-las-variables-generadas-ad-hoc-en-un-sólo-dataframe"><i class="fa fa-check"></i><b>7.4.4</b> Consolidar todas las variables generadas ad-hoc en un sólo dataframe</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-4-crear-sets-de-entrenamiento-y-de-testeo"><i class="fa fa-check"></i><b>7.5</b> Paso 4: Crear sets de entrenamiento y de testeo</a><ul>
<li class="chapter" data-level="7.5.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-5-entrenar-y-testear-un-modelo"><i class="fa fa-check"></i><b>7.5.1</b> Paso 5: Entrenar y testear un modelo</a></li>
<li class="chapter" data-level="7.5.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#midiendo-la-performance-del-modelo-contra-datos-que-no-conoce"><i class="fa fa-check"></i><b>7.5.2</b> Midiendo la performance del modelo contra datos que no conoce</a></li>
<li class="chapter" data-level="7.5.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#comparando-performance"><i class="fa fa-check"></i><b>7.5.3</b> Comparando performance</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#ejercicios-5"><i class="fa fa-check"></i><b>7.6</b> Ejercicios</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analítica Urbana</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geoprocesamiento" class="section level1">
<h1><span class="header-section-number">Capítulo 2</span> Geoprocesamiento</h1>
<p>Cuando tenemos información geográfica y queremos manipularla para generar nuevos datos que nos permitan hacer análisis espaciales, debemos utilizar diferentes herramientas de geoprocesamiento.</p>
<p>Los geoprocesos son operaciones que se llevan a cabo con capas geográficas, que para nosotros toman la forma de dataframes espaciales. Algunas de estas operaciones se aplican a una sola capa geográfica (como agregar un área de influencia alrededor de un polígono), y otras a varias (como calcular la interseción entre una línea y un polígono, o estimar la distancia entre dos puntos). Existen operaciones para unir, recortar, disolver, borrar, fusionar, interseccionar, y calcular áreas de influencia (llamadas <em>buffers</em>), entre otras. En este capítulo aprenderemos a usar varias de ellas, incluidas en el paquete <code>sf</code>.</p>
<div id="cruces-espaciales" class="section level2">
<h2><span class="header-section-number">2.1</span> Cruces espaciales</h2>
<p>Hay ocasiones en que necesitamos cruzar datos de fuentes distintas en base a su ubicación geográfica. Es decir, un “join” que cruce registros en base a sus coordenadas espaciales, en lugar de otros atributos.</p>
<p>Aquí va un ejemplo como guía para realizar el spatial join, o join espacial, que sólo puede ser realizado entre dataframes de tipo espacial.</p>
<p>Paquetes que vamos a usar:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(sf)</a></code></pre></div>
</div>
<div id="dataframes-tradicionales-y-dataframes-espaciales" class="section level2">
<h2><span class="header-section-number">2.2</span> Dataframes tradicionales y dataframes espaciales</h2>
<p>Vamos a trabajar con dos datasets.</p>
<p>Uno contiene los alojamientos ofrecidos por Airbnb en Buenos Aires en Julio 2017.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">airbnb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://query.data.world/s/55amvafrknrgkeyeiu54yb2c6u6brc&quot;</span>,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                   <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">names</span>(airbnb)</a></code></pre></div>
<pre><code>##  [1] &quot;room_id&quot;              &quot;host_id&quot;              &quot;room_type&quot;           
##  [4] &quot;country&quot;              &quot;city&quot;                 &quot;neighborhood&quot;        
##  [7] &quot;address&quot;              &quot;reviews&quot;              &quot;overall_satisfaction&quot;
## [10] &quot;accommodates&quot;         &quot;bedrooms&quot;             &quot;bathrooms&quot;           
## [13] &quot;price&quot;                &quot;deleted&quot;              &quot;minstay&quot;             
## [16] &quot;last_modified&quot;        &quot;latitude&quot;             &quot;longitude&quot;           
## [19] &quot;survey_id&quot;            &quot;location&quot;             &quot;coworker_hosted&quot;     
## [22] &quot;extra_host_languages&quot; &quot;name&quot;                 &quot;property_type&quot;       
## [25] &quot;currency&quot;             &quot;rate_type&quot;</code></pre>
<p>Y el otro contiene los polígonos de las comunas porteñas:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">comunas &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;https://bitsandbricks.github.io/data/CABA_comunas.geojson&#39;</span>)</a></code></pre></div>
<pre><code>## Reading layer `CABA_comunas&#39; from data source `https://bitsandbricks.github.io/data/CABA_comunas.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 15 features and 4 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -58.53152 ymin: -34.70529 xmax: -58.33514 ymax: -34.52754
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Notemos que tenemos dos tipos de dataframe distintos. El de Airbnb es un dataframe “tradicional”, dado que todas sus columnas contiene valores simples: un número, un texto, un factor, etc.</p>
<p>El dataframe de comunas es especial porque es “espacial”. Contiene una columna distinta a las demás, llamada “geometry” que en lugar de una observación simple contiene una lista con múltiples posiciones. Estas posiciones son los vértices que definen el polígono de cada comuna, y permiten la proyección en mapas y el cálculo de estadísticas espaciales.</p>
<div id="combinando-datasets-con-información-espacial" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Combinando datasets con información espacial</h3>
<p>Si lo único que queremos es visualizar en forma combinada la información que contienen, no hay problema en que un dataframe sea espacial y otro no, siempre y cuando éste último incluya una columna con latitud y otra con longitud para identificar la posición de cada registro.</p>
<p>Dado que los datos de Airbnb incluyen lat/long, es fácil visualizarlos en conjunto con el dataframe espacial de las comunas:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> comunas) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airbnb, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">               <span class="kw">aes</span>(<span class="dt">x =</span> longitude, <span class="dt">y =</span> latitude),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">               <span class="dt">alpha =</span> <span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">               <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Dicho esto, si lo que queremos es combinar la información para su análisis cuantitativo, no nos alcanza con la visualización. Lo que tenemos que hacer es un “join espacial”, la técnica que permite cruzar datasets en base a sus atributos de ubicación geográfica.</p>
<p>Sólo es posible hacer joins espaciales entre dataframes espaciales. Es por eso que los datos de Airbnb, así como están, no sirven para un join. ¡Pero! una vez más, dado que incluyen columnas de latitud y longitud, la solución es fácil. Podemos usar las columnas de lat/long para convertirlo en un dataset espacial hecho y derecho, así:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">airbnb &lt;-<span class="st"> </span>airbnb <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(latitude), <span class="op">!</span><span class="kw">is.na</span>(longitude)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">    </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>
<p>Tres cosas importantes a tener en cuenta:</p>
<ol style="list-style-type: decimal">
<li>Un dataframe espacial no permite filas sin posición (sin coordenadas). Por eso antes de la conversión usamos filter(!is.na(latitude), !is.na(longitude)) para descartar los registros sin coordenadas del dataset de origen si los hubiera.</li>
<li>La función st_as_sf() es la que toma un dataframe común y lo transforma en uno espacial. Con el parámetro coords = c(“longitude”, “latitude”) le definimos como se llaman las columnas de longitud y latitud, en ese orden. Obsérvese que toma los nombres entre comillas.</li>
<li>El último parámetro, “crs”, es obligatorio y requiere el identificador del sistema de referencia de las coordenadas. Cuando se trata de datos capturados en internet (como aquí, por scraping del sitio de Airbnb), el crs siempre es 4326.
Ahora que ambos dataframes son de tipo espacial, ambos se grafican con geom_sf()</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> comunas) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> airbnb, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>y más importante aún, se pueden combinar con un join espacial. La versión más simple, que combina atributos de las filas cuyas posiciones coinciden en el espacio, es así:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">airbnb_con_comunas &lt;-<span class="st"> </span><span class="kw">st_join</span>(airbnb, comunas)</a></code></pre></div>
<p>El resultado es un dataframe con datos de Airbnb, que en cada fila incluye los datos de la comuna con la que coincide el alojamiento:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">head</span>(airbnb_con_comunas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 28 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -58.41829 ymin: -34.62068 xmax: -58.37914 ymax: -34.59101
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##    room_id   host_id    room_type country city neighborhood
## 1 15125458  95870458 Private room      NA   NA           NA
## 2  1691316   3380366 Private room      NA   NA           NA
## 3 16069975 104686791 Private room      NA   NA           NA
## 4  4470484   2034113 Private room      NA   NA           NA
## 5  3564816  17949594 Private room      NA   NA           NA
## 6  4479962   8875440 Private room      NA   NA           NA
##                     address reviews overall_satisfaction accommodates bedrooms
## 1    Recoleta, Buenos Aires      23                  4.5            1        1
## 2     Palermo, Buenos Aires     106                  5.0            2        1
## 3    Recoleta, Buenos Aires       5                  5.0            1        1
## 4              Buenos Aires     102                  4.5            2        1
## 5 San Nicolás, Buenos Aires      20                  4.5            1        1
## 6   Balvanera, Буэнос-Айрес     102                  4.5            2        1
##   bathrooms price deleted minstay        last_modified survey_id
## 1        NA   339       0      NA 2017-07-03T17:52:23Z         1
## 2        NA   559       0      NA 2017-07-03T17:52:26Z         1
## 3        NA   254       0      NA 2017-07-03T17:52:26Z         1
## 4        NA   441       0      NA 2017-07-03T17:52:26Z         1
## 5        NA   390       0      NA 2017-07-03T17:52:26Z         1
## 6        NA   424       0      NA 2017-07-03T17:52:26Z         1
##                                             location coworker_hosted
## 1 0101000020E61000000FB743C362324DC0B1DEA815A64B41C0              NA
## 2 0101000020E6100000780E65A88A354DC08A027D224F4C41C0              NA
## 3 0101000020E610000002D4D4B2B5324DC0B5C2F4BD864C41C0              NA
## 4 0101000020E6100000187C9A9317314DC04293C492724F41C0              NA
## 5 0101000020E61000004FC939B187304DC03D29931ADA4C41C0              NA
## 6 0101000020E6100000A6272CF180324DC0A88FC01F7E4E41C0              NA
##   extra_host_languages                                name property_type
## 1                 {en}      Habitacion privada en Recoleta     Apartment
## 2                 {en} Palermo Cozy room wprivate bathroom         House
## 3                 {en}        Habitacion Recoleta, Confort   Condominium
## 4                   {} The Flan Room- Palacio Nr San Telmo         House
## 5                 {en}          &quot;Antique&quot; room @ El Centro     Apartment
## 6                   {}             Private room - Congreso         House
##   currency rate_type
## 1      ARS   nightly
## 2      ARS   nightly
## 3      ARS   nightly
## 4      ARS   nightly
## 5      ARS   nightly
## 6      ARS   nightly
##                                                                        barrios
## 1                                                                     RECOLETA
## 2                                                                      PALERMO
## 3                                                                     RECOLETA
## 4 CONSTITUCION - MONSERRAT - PUERTO MADERO -  RETIRO - SAN NICOLAS - SAN TELMO
## 5 CONSTITUCION - MONSERRAT - PUERTO MADERO -  RETIRO - SAN NICOLAS - SAN TELMO
## 6                                                    BALVANERA - SAN CRISTOBAL
##   perimetro     area comunas                    geometry
## 1  21246.61  6140873       2 POINT (-58.39364 -34.59101)
## 2  21768.07 15772496      14 POINT (-58.41829 -34.59616)
## 3  21246.61  6140873       2 POINT (-58.39617 -34.59786)
## 4  35572.65 17802807       1 POINT (-58.38353 -34.62068)
## 5  35572.65 17802807       1 POINT (-58.37914 -34.60041)
## 6  10486.26  6385991       3 POINT (-58.39456 -34.61322)</code></pre>
<p>Con los atributos adicionales, podemos realizar sumarios por comuna de los alojamientos:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">airbnb_con_comunas <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">    </span><span class="kw">group_by</span>(comunas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">cantidad =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## Simple feature collection with 16 features and 2 fields
## geometry type:  GEOMETRY
## dimension:      XY
## bbox:           xmin: -58.7976 ymin: -34.82524 xmax: -58.18856 ymax: -34.41952
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 16 x 3
##    comunas cantidad                                                     geometry
##  * &lt;fct&gt;      &lt;int&gt;                                               &lt;GEOMETRY [°]&gt;
##  1 1           2100 MULTIPOINT (-58.39242 -34.60016, -58.39235 -34.60115, -58.3…
##  2 10            18 MULTIPOINT (-58.52669 -34.62379, -58.52227 -34.61793, -58.5…
##  3 11            34 MULTIPOINT (-58.52372 -34.60679, -58.51784 -34.61295, -58.5…
##  4 12           163 MULTIPOINT (-58.51262 -34.58124, -58.50698 -34.56917, -58.5…
##  5 13           670 MULTIPOINT (-58.47438 -34.53906, -58.47433 -34.55242, -58.4…
##  6 14          3281 MULTIPOINT (-58.44776 -34.56799, -58.44745 -34.56847, -58.4…
##  7 15           500 MULTIPOINT (-58.49529 -34.593, -58.48774 -34.58506, -58.486…
##  8 2           1659 MULTIPOINT (-58.41587 -34.59755, -58.41514 -34.5967, -58.41…
##  9 3            468 MULTIPOINT (-58.41385 -34.61058, -58.41363 -34.60651, -58.4…
## 10 4            136 MULTIPOINT (-58.4205 -34.64693, -58.42022 -34.64792, -58.41…
## 11 5            422 MULTIPOINT (-58.4313 -34.6024, -58.43129 -34.60154, -58.431…
## 12 6            184 MULTIPOINT (-58.45786 -34.60974, -58.45726 -34.61023, -58.4…
## 13 7             62 MULTIPOINT (-58.47123 -34.62169, -58.47018 -34.62031, -58.4…
## 14 8              1                                  POINT (-58.46999 -34.66616)
## 15 9             15 MULTIPOINT (-58.5287 -34.64678, -58.52213 -34.63636, -58.51…
## 16 &lt;NA&gt;         210 MULTIPOINT (-58.7976 -34.66354, -58.69091 -34.47598, -58.68…</code></pre>
<p>El resultado de un join espacial también es un dataframe espacial, así que podemos visualizarlo de la manera habitual (y ahora tenemos más variables para graficar).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> comunas) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> airbnb_con_comunas, <span class="kw">aes</span>(<span class="dt">color =</span> comunas))</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="coropletas" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Coropletas</h3>
<p>Hasta acá obtuvimos un dataframe espacial con la geometría de puntos proveniente de los datos de Airbnb y generamos una nueva columna que indica a que Comuna pertenece cada uno de los registros. Sin embargo, cuando tenemos muchos puntos concentrados en un mapa resulta difícil realizar un análisis visual que nos permita sacar conclusiones de los datos. Para esto nos sirven las coropletas o mapas coropléticos, que muestran áreas geográficas (polígonos) coloreadas según alguna de las variables incluidas en el dataset.</p>
<p>Continuando con el análisis de Airbnb, haremos un mapa coroplético dándole color a cada Comuna según la cantidad de propiedades que hay en alquiler.</p>
<p>Veamos esto en detalle:
Lo primero que debemos hacer es filtrar solo las propiedades que se ubican dentro de CABA y agruparlas por Comuna calculando la cantidad de observaciones que contiene cada una:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">comunas_airbnb &lt;-<span class="st"> </span>airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(comunas)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(comunas) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())</a></code></pre></div>
<p>Ahora quitemos la geometría de los puntos (columna geometry), que ya no la necesitaremos, y dejemos nuestro dataframe espacial como un dataframe tradicional:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">comunas_airbnb &lt;-<span class="st"> </span>comunas_airbnb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">head</span>(comunas_airbnb)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   comunas cantidad
##   &lt;fct&gt;      &lt;int&gt;
## 1 1           2100
## 2 10            18
## 3 11            34
## 4 12           163
## 5 13           670
## 6 14          3281</code></pre>
<p>Listo, juntemos la información que nos interesa de ambos dataframes a partir de un <code>left_join()</code> entre el shape original con los polígonos de las Comunas y los datos que agrupamos en el paso anterior:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">comunas &lt;-<span class="st"> </span>comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(comunas_airbnb, <span class="dt">by=</span><span class="st">&quot;comunas&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">head</span>(comunas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 5 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -58.4627 ymin: -34.6625 xmax: -58.33514 ymax: -34.56935
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##                                                                        barrios
## 1 CONSTITUCION - MONSERRAT - PUERTO MADERO -  RETIRO - SAN NICOLAS - SAN TELMO
## 2                                                                     RECOLETA
## 3                                                    BALVANERA - SAN CRISTOBAL
## 4                           BARRACAS - BOCA - NUEVA POMPEYA - PARQUE PATRICIOS
## 5                                                              ALMAGRO - BOEDO
## 6                                                                    CABALLITO
##   perimetro     area comunas cantidad                       geometry
## 1  35572.65 17802807       1     2100 MULTIPOLYGON (((-58.36854 -...
## 2  21246.61  6140873       2     1659 MULTIPOLYGON (((-58.39521 -...
## 3  10486.26  6385991       3      468 MULTIPOLYGON (((-58.41192 -...
## 4  36277.44 21701236       4      136 MULTIPOLYGON (((-58.3552 -3...
## 5  12323.47  6660526       5      422 MULTIPOLYGON (((-58.41287 -...
## 6  10990.96  6851029       6      184 MULTIPOLYGON (((-58.43061 -...</code></pre>
<p>Ya estamos en condiciones de hacer nuestro primer mapa coroplético a partir de la unión de un dataframe espacial y un dataframe tradicional. Para reconocer fácilmente las comunas, agreguemos etiquetas con <code>geom_sf_text()</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> comunas, <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf_text</span>(<span class="dt">data=</span>comunas, <span class="kw">aes</span>(<span class="dt">label =</span> comunas), <span class="dt">size=</span><span class="fl">2.5</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Oferta de Airbnb por Comuna&quot;</span>,</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">         <span class="dt">subtitle =</span> <span class="st">&quot;Propiedades publicadas&quot;</span>,</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">         <span class="dt">fill =</span> <span class="st">&quot;Cantidad&quot;</span>,</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Airbnb 2017&quot;</span>,</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">         <span class="dt">y=</span><span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">         <span class="dt">x=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;khaki2&quot;</span>, <span class="dt">high=</span><span class="st">&quot;deeppink4&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Tal como se ve en el mapa, a lo largo del corredor Norte de la Ciudad, y más específicamente en la Comuna 14, es donde Airbnb tiene la mayor cantidad de propiedades publicadas. Esto tiene sentido ya que Airbnb es un servicio orientado a turistas, y estas Comunas son las que tienen la mayor cantidad de atracciones turísticas.</p>
<p>Sin embargo, para que estos datos sean comparables entre las 15 Comunas, relacionemos la cantidad de observaciones que tienen con la superficie (ha) de cada una:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> comunas, <span class="kw">aes</span>(<span class="dt">fill=</span>(cantidad<span class="op">/</span>area)<span class="op">*</span><span class="dv">10000</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf_text</span>(<span class="dt">data=</span>comunas, <span class="kw">aes</span>(<span class="dt">label =</span> comunas), <span class="dt">size=</span><span class="fl">2.5</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Oferta de Airbnb por Comuna&quot;</span>,</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">         <span class="dt">subtitle =</span> <span class="st">&quot;Densidad de propiedades publicadas&quot;</span>,</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">         <span class="dt">fill =</span> <span class="st">&quot;Cantidad por ha&quot;</span>,</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Airbnb 2017&quot;</span>,</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">         <span class="dt">y=</span><span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">         <span class="dt">x=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;khaki2&quot;</span>, <span class="dt">high=</span><span class="st">&quot;deeppink4&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Aquí pudimos ver que los resultados son similares a los del primer mapa coroplético, y que el corredor Norte sigue siendo la zona donde se concentra la mayor parte de la oferta. Pero si tenemos en cuenta la superficie total de las Comunas, notamos que la 2 (Recoleta) es la que más densidad de observaciones tiene, seguida por la Comuna 14.</p>
</div>
</div>
<div id="uniones" class="section level2">
<h2><span class="header-section-number">2.3</span> Uniones</h2>
<p>Cuando realizamos análisis espaciales, es muy común que nos encontremos con la necesidad de combinar información geográfica. Esto se resuelve fácilmente a partir de un geoproceso llamado unión, que en el paquete <code>sf</code> lo encontraremos como <code>st_union</code>. Esta herramienta tiene 2 funcionalidades:</p>
<ol style="list-style-type: decimal">
<li><p>Unir registros de una misma capa, generando un único dato.</p></li>
<li><p>Unir las geometrías de dos capas, generando una capa única que contenga la información de ambas.</p></li>
</ol>
<p>Empecemos combinando los registros de nuestro dataframe espacial de comunas de manera tal que generemos un nuevo dataframe que contenga un único polígono de la Ciudad:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">caba &lt;-<span class="st"> </span>comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw">st_union</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>
<p>Veamos cuantos registros tiene el dataframe de comunas:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">dim</span>(comunas)</a></code></pre></div>
<pre><code>## [1] 15  6</code></pre>
<p>Revisemos el resultado de nuestra unión:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">dim</span>(caba)</a></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
<p>Efectivamente, pasamos de tener registros para las 15 comunas, a tener tan solo 1. Pero veamos esto en un mapa para entender mejor como funciona la unión:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>caba)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Tal como lo imaginamos, en el mapa vemos que se unieron las 15 Comunas y ya no aparecen sus límites. Quedó un solo polígono con la forma de toda la Ciudad.</p>
<p>Pero esto no es todo. Como se mencionó anteriormente, también se pueden combinar/unir capas diferentes, generando un único dataframe espacial. Por ejemplo, seleccionemos las 2 comunas con mayor densidad de publicaciones de Airbnb y generamos un dataframe para cada una:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">comuna_<span class="dv">2</span> &lt;-<span class="st"> </span>comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(comunas<span class="op">==</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"></a>
<a class="sourceLine" id="cb30-4" data-line-number="4">comuna_<span class="dv">14</span> &lt;-<span class="st"> </span>comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(comunas<span class="op">==</span><span class="dv">14</span>)</a></code></pre></div>
<p>Veamos como lucen:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf_text</span>(<span class="dt">data=</span>comuna_<span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">label =</span> comunas), <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">14</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_sf_text</span>(<span class="dt">data=</span>comuna_<span class="dv">14</span>, <span class="kw">aes</span>(<span class="dt">label =</span> comunas), <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Y ahora unamos:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">comuna_<span class="dv">14</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">st_union</span>(comuna_<span class="dv">14</span>, comuna_<span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">14</span>_<span class="dv">2</span>, <span class="dt">fill=</span><span class="st">&quot;orange&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Como se puede ver en el mapa, al aplicar <code>st_union</code> se combinaron las 2 comunas que estaban en dataframes separados y se generó un único dataframe espacial con toda la información.</p>
</div>
<div id="intersecciones" class="section level2">
<h2><span class="header-section-number">2.4</span> Intersecciones</h2>
<p>Muchas veces nos encontramos con que 2 capas geográficas se solapan y queremos obtener como resultado los datos que se intersectan. Para este tipo de análisis, utilizamos <code>st_intersection</code> de nuestro ya conocido paquete <code>sf</code>.
Hacer una intersección entre 2 capas significa que ambas geometrías serán recortadas, generando una nueva capa que contenga solo las entidades que se encuentran superpuestas.</p>
<p>Llevemos esto a datos reales y veamos un ejemplo de como crear un dataframe que contenga solo las observaciones de Airbnb que intersecten con el polígono de CABA creado en el paso anterior, y así eliminar todos los registros ubicados en AMBA.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">dim</span>(airbnb_con_comunas)</a></code></pre></div>
<pre><code>## [1] 9923   29</code></pre>
<p>Antes de aplicar la función, nos encontramos con que hay un total de 9.923 observaciones. Veamos que sucede después:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">airbnb_con_comunas &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(airbnb_con_comunas, caba)</a></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">dim</span>(airbnb_con_comunas)</a></code></pre></div>
<pre><code>## [1] 9713   29</code></pre>
<p>Según los resultados obtenidos, son 9.713 las observaciones que pertenecen a la Ciudad. Veamos esto en un mapa:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>caba) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>airbnb_con_comunas, <span class="dt">size=</span><span class="fl">0.75</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Listo, todo funcionó bien asi que ya tenemos nuestro dataframe espacial de Airbnb recortado a partir de una intersección espacial con CABA.</p>
<p>Ahora hagamos una prueba más e intersectemos solo con las observaciones localizadas en las Comunas 2 y 14 filtradas anteriormente:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">airbnb_comuna_<span class="dv">14</span>_<span class="dv">2</span> &lt;-<span class="st"> </span>airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw">st_intersection</span>(comuna_<span class="dv">14</span>_<span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comunas) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>airbnb_comuna_<span class="dv">14</span>_<span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color=</span>comunas), <span class="dt">size=</span><span class="fl">0.4</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">dim</span>(airbnb_comuna_<span class="dv">14</span>_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 4940   39</code></pre>
<p>De las 9.713 observaciones que vimos que caen en CABA, 4.940 caen en las comunas analizadas. Tal como era de esperar, esto representa más de un 50% de la muestra.</p>
</div>
<div id="distancias" class="section level2">
<h2><span class="header-section-number">2.5</span> Distancias</h2>
<p>Ahora veamos como calcular distancias euclideanas entre datos espaciales, lo cual resulta muy útil a la hora de comprender como se organizan y relacionan entre sí diferentes entidades geográficas. Es decir que, esta herramienta nos permitirá agregar información a nuestros datos a partir de la relación espacial que tienen con otros datos. En <code>sf</code>, esto lo encontraremos bajo el nombre de <code>st_distance</code>.</p>
<p>Comencemos con algo simple: Calculemos la distancia que hay entre los centroides de las 2 comunas con mayor densidad de oferta de Airbnb. Para establecer un único punto en cada comuna y poder realizar el cálculo, vamos a utilizar sus centroides que los calcularemos con la función <code>st_centroid</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">comuna_<span class="dv">2</span> &lt;-<span class="st"> </span>comuna_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">  </span><span class="kw">st_centroid</span>()</a>
<a class="sourceLine" id="cb44-3" data-line-number="3"></a>
<a class="sourceLine" id="cb44-4" data-line-number="4">comuna_<span class="dv">14</span> &lt;-<span class="st"> </span>comuna_<span class="dv">14</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="st">  </span><span class="kw">st_centroid</span>()</a></code></pre></div>
<p>Veamos el resultado en un mapa:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comunas, <span class="dt">color=</span><span class="st">&quot;gray&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">2</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">shape=</span><span class="dv">4</span>, <span class="dt">stroke=</span><span class="dv">2</span>, <span class="dt">size=</span><span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">14</span>, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">shape=</span><span class="dv">4</span>, <span class="dt">stroke=</span><span class="dv">2</span>, <span class="dt">size=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Y ahora calculemos la distancia entre ambos:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">st_distance</span>(comuna_<span class="dv">2</span>, comuna_<span class="dv">14</span>)</a></code></pre></div>
<pre><code>## Units: [m]
##         [,1]
## [1,] 2847.48</code></pre>
<p>Nos encontramos con que la distancia lineal entre el centroide de la Comuna 2 y el de la Comuna 14 es de 2.847,48 metros, es decir, unas 28 cuadras aproximadamente.</p>
<p>Veamos un ejemplo más: Veamos a cuántos metros del centroide de la Comuna 2 se encuentran el resto de propiedades publicadas. Calcularemos el resultado en una nueva columna de nuestro dataframe llamada dist_comuna2:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">airbnb_con_comunas &lt;-<span class="st"> </span>airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist_comuna2 =</span> <span class="kw">st_distance</span>(airbnb_con_comunas, comuna_<span class="dv">2</span>))</a></code></pre></div>
<p>Analicemos los resultados:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">summary</span>(airbnb_con_comunas<span class="op">$</span>dist_comuna2)</a></code></pre></div>
<pre><code>##        V1          
##  Min.   :   21.92  
##  1st Qu.: 1786.36  
##  Median : 2928.83  
##  Mean   : 3202.80  
##  3rd Qu.: 4149.21  
##  Max.   :13963.07</code></pre>
<p>Vemos que las propiedades más cercanas, se ubican a 21,92 metros, y las más lejanas a 13.963,07 metros. En promedio, todos los registros están ubicados a 3.202,8 metros del centroide de la Comuna 2, es decir, aproximadamente 32 cuadras.</p>
<p>Revisemos la distribución en un histograma:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">ggplot</span>(airbnb_con_comunas)<span class="op">+</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.numeric</span>(dist_comuna2)))</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Y en un mapa:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>caba, <span class="dt">color=</span><span class="st">&quot;gray&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>airbnb_con_comunas, <span class="kw">aes</span>(<span class="dt">color=</span><span class="kw">as.numeric</span>(dist_comuna2)))<span class="op">+</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comuna_<span class="dv">2</span>, <span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">shape=</span><span class="dv">4</span>, <span class="dt">stroke=</span><span class="dv">2</span>, <span class="dt">size=</span><span class="fl">1.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">direction =</span> <span class="dv">-1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Distancia a la Comuna 2&quot;</span>,</a>
<a class="sourceLine" id="cb52-7" data-line-number="7">       <span class="dt">subtitle=</span><span class="st">&quot;Oferta Airbnb 2017&quot;</span>,</a>
<a class="sourceLine" id="cb52-8" data-line-number="8">       <span class="dt">color=</span><span class="st">&quot;Distancia&quot;</span>,</a>
<a class="sourceLine" id="cb52-9" data-line-number="9">       <span class="dt">x=</span><span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb52-10" data-line-number="10">       <span class="dt">y=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Tanto en el histograma como en el mapa se aprecia perfectamente como la mayoría de las propiedaddes se ubican a menos de 5.000 metros del centroide de la Comuna.</p>
<p><strong>Bonus Track</strong>
Hagamos un poco más complejo el análisis aprovechando que los datos que estamos analizando en este capítulo pertenecen a la oferta de alquileres turísticos, y calculemos la distancia entre cada una de las propiedades publicadas en Airbnb y cada uno de los hoteles de la Ciudad, para entender si hay similitudes en como se distribuyen ambas ofertas en el territorio. Esto será posible a partir del armado de una función que nos permita calcular y filtrar la distancia de cada una de las propiedades publicadas en Airbnb al hotel más cercano.</p>
<p>Primero cargamos el dataset de hoteles que está publicado en le portal de datos abiertos de GCBA:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">hoteles &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://cdn.buenosaires.gob.ar/datosabiertos/datasets/alojamientos-turisticos/alojamientos-turisticos.csv&quot;</span>,</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">                    <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</a></code></pre></div>
<p>Y lo convertimos a shape como ya aprendimos:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">hoteles &lt;-<span class="st"> </span>hoteles <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lat), <span class="op">!</span><span class="kw">is.na</span>(long)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="st">    </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>
<p>Luego creamos una nueva columna en donde calculamos la distancia de cada propiedad a cada hotel, pero nos quedamos únicamente con la distancia a la estación más cercana.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">airbnb_con_comunas &lt;-<span class="st"> </span>airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist_hotel =</span> <span class="kw">apply</span>(<span class="kw">st_distance</span>(airbnb_con_comunas, hoteles), <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">min</span>(x)))</a></code></pre></div>
<p>Revisemos como se ve el resultado obtenido:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(room_type, name, dist_hotel) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -58.41829 ymin: -34.62068 xmax: -58.37914 ymax: -34.59101
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##      room_type                                name dist_hotel
## 1 Private room      Habitacion privada en Recoleta  142.02029
## 2 Private room Palermo Cozy room wprivate bathroom  162.42654
## 3 Private room        Habitacion Recoleta, Confort  116.76407
## 4 Private room The Flan Room- Palacio Nr San Telmo   38.54021
## 5 Private room          &quot;Antique&quot; room @ El Centro   90.17597
## 6 Private room             Private room - Congreso  203.75457
##                      geometry
## 1 POINT (-58.39364 -34.59101)
## 2 POINT (-58.41829 -34.59616)
## 3 POINT (-58.39617 -34.59786)
## 4 POINT (-58.38353 -34.62068)
## 5 POINT (-58.37914 -34.60041)
## 6 POINT (-58.39456 -34.61322)</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">summary</span>(airbnb_con_comunas<span class="op">$</span>dist_hotel)</a></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    1.408   91.583  169.227  260.199  318.691 4828.336</code></pre>
<p>La mínima distancia entre una propiedad publicada en Airbnb y un hotel es de 1,4 metros y la máxima es de 4.828 metros. Sin embargo, si miramos la media podemos ver que las propiedades se encuentran, en promedio, a 260 metros del hotel más cercano, lo cuál es muy cerca. A priori con estos datos, parecería ser que la localización de los Airbnb está muy relacionada con la de los hoteles.</p>
<p>Visualicemos esto en un histograma para comprender mejor la distribución de los datos:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">ggplot</span>(airbnb_con_comunas) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist_hotel))</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>La mayor parte de las observaciones se encuentra a menos de 250 metros de algun hotel. Veamos esto en un mapa:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">airbnb_con_comunas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>comunas)<span class="op">+</span></a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">color=</span>dist_hotel)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>hoteles) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="dt">direction =</span> <span class="dv">-1</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>En el mapa se ve como la distribución de la oferta de propiedades no es aleatoria, sino que responde a la demanda de los turistas ya que la mayor parte está ubicada cerca de hoteles (puntos negros). Los patrones de los 2 dataset son muy similares: gran concentración de puntos en Recoleta, Retiro y Microcento, extendiéndose hacia el corredor norte y siendo casi nula hacia el sur de la Ciudad.</p>
</div>
<div id="cálculo-de-extensión-longitud-área" class="section level2">
<h2><span class="header-section-number">2.6</span> Cálculo de extensión (longitud, área)</h2>
<p>Otras herramientas muy importantes a la hora de realizar un análisis espacial son los cálculos de extensión de geometrías, esto hace referencia a calcular áreas o longitudes.</p>
<p>En la analítica urbana, el cálculo de áreas suele utilizarse para medir superficies de comunas, barrios, radios censales o cualquier otro polígono que se ubique en el territorio. Y el cálculo de longitud suele realizarse para medir el perímetro de alguno de estos polígonos o la extensión de la red de subte, FFCC, etc. Para ambas herramientas, tenemos una función del paquete <code>sf</code>: estas son <code>st_area</code> y <code>st_length</code>.</p>
<p>Veamos de que se tratan estas funciones y comencemos calculando la superficie y el perímetro de todo el polígono de la Ciudad de Buenos Aires. Para esto agreguemos 2 columnas al dataframe de CABA con el que veníamos trabajando previamente:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">caba &lt;-<span class="st"> </span>caba <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">superficie=</span><span class="kw">st_area</span>(caba),</a>
<a class="sourceLine" id="cb62-3" data-line-number="3">         <span class="dt">perimetro=</span><span class="kw">st_length</span>(caba))</a></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">caba<span class="op">$</span>superficie</a></code></pre></div>
<pre><code>## 203678002 [m^2]</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">caba<span class="op">$</span>perimetro</a></code></pre></div>
<pre><code>## 128613.8 [m]</code></pre>
<p>Los resultados de área y perímetro se expresan en m2 y m, pasemoslos a ha y km respectivamente:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">caba &lt;-<span class="st"> </span>caba <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">superficie_ha=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(superficie)<span class="op">/</span><span class="dv">10000</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">         <span class="dt">perimetro_km=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(perimetro)<span class="op">/</span><span class="dv">1000</span>, <span class="dv">2</span>))</a></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">caba<span class="op">$</span>superficie_ha</a></code></pre></div>
<pre><code>## [1] 20367.8</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">caba<span class="op">$</span>perimetro_km</a></code></pre></div>
<pre><code>## [1] 128.61</code></pre>
<p>Listo! Con pocas líneas código ya pudimos conocer ambos resultados. Según nuestros cálculos, la superficie de toda la Ciudad de Buenos Aires es de 20.367,8 ha y el perímetro de 128,61 km.</p>
<p>Veamos algunos ejemplos más: Calculemos la superficie de cada uno de los 48 barrios de la Ciudad y veamos cuales son los de mayor tamaño. Para esto comencemos cargando el geoJSON de barrios:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">barrios &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;https://raw.githubusercontent.com/angiescetta/datos-geo/master/barrios.geojson&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `barrios&#39; from data source `https://raw.githubusercontent.com/angiescetta/datos-geo/master/barrios.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 48 features and 2 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -58.53152 ymin: -34.70529 xmax: -58.33515 ymax: -34.52649
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Creemos una nueva columna para calcular las superficies:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">barrios &lt;-<span class="st"> </span>barrios <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">superficie=</span><span class="kw">st_area</span>(barrios))</a></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">head</span>(barrios)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -58.50617 ymin: -34.63064 xmax: -58.41192 ymax: -34.57829
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##             barrio comuna                       geometry    superficie
## 1        CHACARITA     15 POLYGON ((-58.45282 -34.595... 3115708 [m^2]
## 2         PATERNAL     15 POLYGON ((-58.46558 -34.596... 2229830 [m^2]
## 3     VILLA CRESPO     15 POLYGON ((-58.42375 -34.597... 3615979 [m^2]
## 4 VILLA DEL PARQUE     11 POLYGON ((-58.49461 -34.614... 3399597 [m^2]
## 5          ALMAGRO      5 POLYGON ((-58.41287 -34.614... 4050753 [m^2]
## 6        CABALLITO      6 POLYGON ((-58.43061 -34.607... 6851031 [m^2]</code></pre>
<p>Nuevamente los resultados están en m2, hagamos una conversión a ha para facilitar la lectura de los mismos:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">barrios &lt;-<span class="st"> </span>barrios <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">superficie_ha=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(superficie)<span class="op">/</span><span class="dv">10000</span>, <span class="dv">2</span>))</a></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">select</span>(barrios, barrio, superficie_ha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##        barrio   superficie_ha             geometry 
##  AGRONOMIA: 1   Min.   : 123.2   POLYGON      :48  
##  ALMAGRO  : 1   1st Qu.: 222.2   epsg:4326    : 0  
##  BALVANERA: 1   Median : 368.0   +proj=long...: 0  
##  BARRACAS : 1   Mean   : 424.3                     
##  BELGRANO : 1   3rd Qu.: 514.3                     
##  BOCA     : 1   Max.   :1584.6                     
##  (Other)  :42</code></pre>
<p>Ahora si, podemos ver que, las superficies de los barrios son bastante variadas: van desde 123 ha a 1.584 ha, siendo el promedio 424 ha.</p>
<p>Entremos más en detalle y veamos cuántos son los barrios que tienen una superficie por encima de la media y cuántos por debajo. Para esto creemos una nueva columna llamada categoría:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">barrios &lt;-<span class="st"> </span>barrios <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">categoria=</span><span class="kw">ifelse</span>(superficie_ha<span class="op">&gt;</span><span class="kw">mean</span>(superficie_ha),<span class="st">&quot;MAYOR SUPERFICIE&quot;</span>,<span class="st">&quot;MENOR SUPERFICIE&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">barrios <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(categoria) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## Simple feature collection with 2 features and 2 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -58.53152 ymin: -34.70529 xmax: -58.33515 ymax: -34.52649
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 2 x 3
##   categoria     cantidad                                                geometry
## * &lt;chr&gt;            &lt;int&gt;                                      &lt;MULTIPOLYGON [°]&gt;
## 1 MAYOR SUPERF…       20 (((-58.43492 -34.64624, -58.43354 -34.64562, -58.43348…
## 2 MENOR SUPERF…       28 (((-58.44978 -34.68061, -58.44863 -34.68152, -58.44451…</code></pre>
<p>La mayoría de los barrios (28) tienen una superficie por debajo de la media, mientras que el resto (20) tienen una superficie por encima de la misma. Veamos esto en un mapa:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>barrios, <span class="kw">aes</span>(<span class="dt">fill=</span>categoria))<span class="op">+</span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Barrios de CABA según superficie (ha)&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>A simple vista, y en términos generales, se podría decir que, los barrios del Norte y Sur de la Ciudad son los que tienen la mayor superficie, mientras que los del Centro son los que tienen la menor.</p>
<p>Veamos un último ejemplo: Calculemos la extensión de todas las líneas que componen la red de subterráneos de CABA para ver cuales son las que tienen mayor cobertura. Carguemos el geoJSON:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">subte_lineas &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;http://bitsandbricks.github.io/data/subte_lineas.geojson&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `subte_lineas&#39; from data source `http://bitsandbricks.github.io/data/subte_lineas.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 80 features and 2 fields
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: -58.48639 ymin: -34.64331 xmax: -58.36993 ymax: -34.55564
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Y calculemos longitud:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">subte_lineas &lt;-<span class="st"> </span>subte_lineas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">longitud=</span><span class="kw">st_length</span>(subte_lineas))</a></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="kw">head</span>(subte_lineas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: -58.45649 ymin: -34.58516 xmax: -58.41596 ymax: -34.56231
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##   ID LINEASUB                       geometry      longitud
## 1  1  LINEA D MULTILINESTRING ((-58.45213...  803.7500 [m]
## 2  2  LINEA D MULTILINESTRING ((-58.45649...  599.8831 [m]
## 3  3  LINEA D MULTILINESTRING ((-58.44467... 1055.4827 [m]
## 4  4  LINEA D MULTILINESTRING ((-58.43501...  928.8651 [m]
## 5  5  LINEA D MULTILINESTRING ((-58.42571...  531.1796 [m]
## 6  6  LINEA D MULTILINESTRING ((-58.4212 ...  635.6720 [m]</code></pre>
<p>Aquí podemos ver que en el shape, cada línea de subte está construida por varias geometrías (líneas). Para calcular la longitud total de cada línea debemos sumar las longitudes de cada uno de los tramos que la componen:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">subte_lineas &lt;-<span class="st"> </span>subte_lineas <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(LINEASUB) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">longitud=</span><span class="kw">sum</span>(<span class="kw">as.numeric</span>(longitud))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(longitud))</a>
<a class="sourceLine" id="cb89-5" data-line-number="5"></a>
<a class="sourceLine" id="cb89-6" data-line-number="6">subte_lineas</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: -58.48639 ymin: -34.64331 xmax: -58.36993 ymax: -34.55564
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 6 x 3
##   LINEASUB longitud                                                     geometry
##   &lt;fct&gt;       &lt;dbl&gt;                                        &lt;MULTILINESTRING [°]&gt;
## 1 LINEA B    11770. ((-58.39947 -34.60464, -58.40363 -34.60476, -58.4054 -34.60…
## 2 LINEA D    10462. ((-58.38057 -34.60425, -58.37945 -34.60484, -58.37532 -34.6…
## 3 LINEA A     9643. ((-58.46354 -34.62909, -58.46411 -34.62925, -58.46534 -34.6…
## 4 LINEA E     9641. ((-58.45789 -34.64014, -58.45835 -34.64048, -58.4595 -34.64…
## 5 LINEA H     7217. ((-58.40579 -34.63841, -58.40703 -34.63867, -58.40731 -34.6…
## 6 LINEA C     4437. ((-58.38143 -34.62762, -58.38146 -34.62704, -58.38146 -34.6…</code></pre>
<p>De las 6 líneas que aparecen en el dataframe, la que tiene mayor cobertura es la Línea B, seguida por la D. Y la que tiene menor cobertura es la C. También se puede ver que las líneas A y E tienen una longitud muy similar, con una diferencia de solo 2km.</p>
<p>Llevemos esta información a un mapa:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>caba)<span class="op">+</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>subte_lineas, <span class="kw">aes</span>(<span class="dt">color=</span>longitud), <span class="dt">size=</span><span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf_label</span>(<span class="dt">data=</span>subte_lineas, <span class="kw">aes</span>(<span class="dt">label =</span> LINEASUB), <span class="dt">size=</span><span class="fl">1.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="dt">direction=</span><span class="op">-</span><span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb91-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Líneas de SUBTE según longitud (km)&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
<div id="ejercicios" class="section level2">
<h2><span class="header-section-number">2.7</span> Ejercicios</h2>
<p><strong>Adquiriendo open data urbana + Calculando y mapeando agregados por área</strong></p>
<p>I. Elegir una ciudad en cualquier parte del mundo que les interese y que disponga de un portal de datos abiertos que ofrece un shapefile con sus barrios.</p>
<ol start="2" style="list-style-type: upper-roman">
<li><p>Del mismo portal de datos, o de otra fuente si la tienen, elegir un dataset con registros geo-referenciados. Por ejemplo, las escuelas de la ciudad (o las comisarías, o las propiedades en alquiler, o…) con sus coordenadas.</p></li>
<li><p>Realizar un join espacial, asignando a cada registro geo-referenciado el barrio que le corresponde.</p></li>
<li>Utilizando ggplot() realizar:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Un gráfico (barras, puntos, o el que prefieran) para mostrar los resultados de cantidad por barrio.</li>
<li>Un mapa con los límites de los barrios, cuyo color de relleno indique la cantidad encontrada en cada uno.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["analitica_urbana.pdf", "analitica_urbana.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
