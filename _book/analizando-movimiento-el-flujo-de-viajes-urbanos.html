<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 6 Analizando movimiento: el flujo de viajes urbanos | Analítica Urbana</title>
  <meta name="description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 6 Analizando movimiento: el flujo de viajes urbanos | Analítica Urbana" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 6 Analizando movimiento: el flujo de viajes urbanos | Analítica Urbana" />
  
  <meta name="twitter:description" content="Un manual para la obtención, procesamiento, análisis y visualización de datos urbanos" />
  

<meta name="author" content="Antonio Vazquez Brust &amp; Angie Scetta" />


<meta name="date" content="2020-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="analizando-dinámicas-espacio-temporales.html"/>
<link rel="next" href="machine-learning-en-una-aplicación-urbana.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analítica Urbana</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>¿Para quién es esto?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#antes-de-empezar"><i class="fa fa-check"></i>Antes de empezar</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#sobre-la-analítica-urbana"><i class="fa fa-check"></i><b>1.1</b> Sobre la analítica urbana</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html"><i class="fa fa-check"></i><b>2</b> Geoprocesamiento</a><ul>
<li class="chapter" data-level="2.1" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#cruces-espaciales"><i class="fa fa-check"></i><b>2.1</b> Cruces espaciales</a><ul>
<li class="chapter" data-level="2.1.1" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#dataframes-tradicionales-y-dataframes-espaciales"><i class="fa fa-check"></i><b>2.1.1</b> Dataframes tradicionales y dataframes espaciales</a></li>
<li class="chapter" data-level="2.1.2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#combinando-datasets-con-información-espacial"><i class="fa fa-check"></i><b>2.1.2</b> Combinando datasets con información espacial</a></li>
<li class="chapter" data-level="2.1.3" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#coropletas"><i class="fa fa-check"></i><b>2.1.3</b> Coropletas</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#uniones"><i class="fa fa-check"></i><b>2.2</b> Uniones</a></li>
<li class="chapter" data-level="2.3" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#intersecciones"><i class="fa fa-check"></i><b>2.3</b> Intersecciones</a></li>
<li class="chapter" data-level="2.4" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#distancias"><i class="fa fa-check"></i><b>2.4</b> Distancias</a></li>
<li class="chapter" data-level="2.5" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#cálculo-de-extensión-longitud-área"><i class="fa fa-check"></i><b>2.5</b> Cálculo de extensión (longitud, área)</a></li>
<li class="chapter" data-level="2.6" data-path="geoprocesamiento.html"><a href="geoprocesamiento.html#ejercicios"><i class="fa fa-check"></i><b>2.6</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><i class="fa fa-check"></i><b>3</b> Acceso a información urbana georeferenciada en repositorios <em>online</em></a><ul>
<li class="chapter" data-level="3.1" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#openstreetmap-desde-r"><i class="fa fa-check"></i><b>3.1</b> OpenStreetMap desde R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#definiendo-el-lugar"><i class="fa fa-check"></i><b>3.1.1</b> Definiendo el lugar</a></li>
<li class="chapter" data-level="3.1.2" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#extrayendo-información-de-openstreetmap"><i class="fa fa-check"></i><b>3.1.2</b> Extrayendo información de OpenStreetMap</a></li>
<li class="chapter" data-level="3.1.3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#visualizando-los-resultados"><i class="fa fa-check"></i><b>3.1.3</b> Visualizando los resultados</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#un-ejercicio-más-bares-en-el-barrio"><i class="fa fa-check"></i><b>3.2</b> Un ejercicio más: ¡Bares en el barrio!</a></li>
<li class="chapter" data-level="3.3" data-path="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html"><a href="acceso-a-información-urbana-georeferenciada-en-repositorios-online.html#ejercicios-1"><i class="fa fa-check"></i><b>3.3</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html"><i class="fa fa-check"></i><b>4</b> Obteniendo y analizando datos de redes sociales</a><ul>
<li class="chapter" data-level="4.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#investigando-con-social-media"><i class="fa fa-check"></i><b>4.1</b> Investigando con social media</a><ul>
<li class="chapter" data-level="4.1.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#los-desafíos-de-trabajar-con-información-de-repositorios-sociales"><i class="fa fa-check"></i><b>4.1.1</b> Los desafíos de trabajar con información de repositorios sociales</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#conectando-r-a-twitter"><i class="fa fa-check"></i><b>4.2</b> Conectando R a Twitter</a><ul>
<li class="chapter" data-level="4.2.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#obteniendo-autorización"><i class="fa fa-check"></i><b>4.2.1</b> Obteniendo autorización</a></li>
<li class="chapter" data-level="4.2.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#acceso-a-twitter-via-r-el-paquete-rtweet"><i class="fa fa-check"></i><b>4.2.2</b> Acceso a Twitter via R: el paquete <em>rtweet</em></a></li>
<li class="chapter" data-level="4.2.3" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#usuarios-más-populares"><i class="fa fa-check"></i><b>4.2.3</b> Usuarios más populares</a></li>
<li class="chapter" data-level="4.2.4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#tweets-más-populares"><i class="fa fa-check"></i><b>4.2.4</b> Tweets más populares</a></li>
<li class="chapter" data-level="4.2.5" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#la-hora-del-día-a-la-que-se-producen-los-tweets"><i class="fa fa-check"></i><b>4.2.5</b> La hora del día a la que se producen los tweets</a></li>
<li class="chapter" data-level="4.2.6" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#procedencia-de-los-usuarios"><i class="fa fa-check"></i><b>4.2.6</b> Procedencia de los usuarios</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#escuchando-tweets-en-tiempo-real"><i class="fa fa-check"></i><b>4.3</b> Escuchando tweets en tiempo real</a></li>
<li class="chapter" data-level="4.4" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#capturando-tweets-por-períodos-prolongados"><i class="fa fa-check"></i><b>4.4</b> Capturando tweets por períodos prolongados</a></li>
<li class="chapter" data-level="4.5" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#capturando-tweets-en-zonas-específicas"><i class="fa fa-check"></i><b>4.5</b> Capturando tweets en zonas específicas</a><ul>
<li class="chapter" data-level="4.5.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#extraer-las-coordenadas"><i class="fa fa-check"></i><b>4.5.1</b> Extraer las coordenadas</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#visualizando-los-datos-georeferenciados"><i class="fa fa-check"></i><b>4.6</b> Visualizando los datos georeferenciados</a><ul>
<li class="chapter" data-level="4.6.1" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#mapas-estáticos-con-ggmap"><i class="fa fa-check"></i><b>4.6.1</b> Mapas estáticos con ggmap</a></li>
<li class="chapter" data-level="4.6.2" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#mapas-interactivos-con-leaflet"><i class="fa fa-check"></i><b>4.6.2</b> Mapas interactivos con leaflet</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="obteniendo-y-analizando-datos-de-redes-sociales.html"><a href="obteniendo-y-analizando-datos-de-redes-sociales.html#ejercicios-2"><i class="fa fa-check"></i><b>4.7</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html"><i class="fa fa-check"></i><b>5</b> Analizando dinámicas espacio-temporales</a><ul>
<li class="chapter" data-level="5.0.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#trabajando-con-fechas"><i class="fa fa-check"></i><b>5.0.1</b> Trabajando con fechas</a></li>
<li class="chapter" data-level="5.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#mirando-al-espacio"><i class="fa fa-check"></i><b>5.1</b> Mirando al espacio</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#obteniendo-un-mapa-base"><i class="fa fa-check"></i><b>5.1.1</b> Obteniendo un mapa base</a></li>
<li class="chapter" data-level="5.1.2" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#de-coordenadas-al-mapa"><i class="fa fa-check"></i><b>5.1.2</b> De coordenadas al mapa</a></li>
<li class="chapter" data-level="5.1.3" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#mapas-de-densidad"><i class="fa fa-check"></i><b>5.1.3</b> Mapas de densidad</a></li>
<li class="chapter" data-level="5.1.4" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#visualizando-multiples-categorías"><i class="fa fa-check"></i><b>5.1.4</b> Visualizando multiples categorías</a></li>
<li class="chapter" data-level="5.1.5" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#combinando-espacio-y-tiempo"><i class="fa fa-check"></i><b>5.1.5</b> Combinando espacio y tiempo</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analizando-dinámicas-espacio-temporales.html"><a href="analizando-dinámicas-espacio-temporales.html#ejercicios-3"><i class="fa fa-check"></i><b>5.2</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><i class="fa fa-check"></i><b>6</b> Analizando movimiento: el flujo de viajes urbanos</a><ul>
<li class="chapter" data-level="6.1" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#estimando-rutas"><i class="fa fa-check"></i><b>6.1</b> Estimando rutas</a></li>
<li class="chapter" data-level="6.2" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#cuantificando-interacción"><i class="fa fa-check"></i><b>6.2</b> Cuantificando interacción</a></li>
<li class="chapter" data-level="6.3" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#estimando-rutas-1"><i class="fa fa-check"></i><b>6.3</b> Estimando rutas</a></li>
<li class="chapter" data-level="6.4" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#extra-cómo-obtener-las-rutas-de-todos-los-recorridos"><i class="fa fa-check"></i><b>6.4</b> EXTRA: Cómo obtener las rutas de todos los recorridos</a></li>
<li class="chapter" data-level="6.5" data-path="analizando-movimiento-el-flujo-de-viajes-urbanos.html"><a href="analizando-movimiento-el-flujo-de-viajes-urbanos.html#ejercicios-4"><i class="fa fa-check"></i><b>6.5</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html"><i class="fa fa-check"></i><b>7</b> Machine Learning (en una aplicación urbana)</a><ul>
<li class="chapter" data-level="7.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-0-cargar-paquetes"><i class="fa fa-check"></i><b>7.1</b> Paso 0: Cargar paquetes</a></li>
<li class="chapter" data-level="7.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-1-cargar-los-datos"><i class="fa fa-check"></i><b>7.2</b> Paso 1: Cargar los datos</a></li>
<li class="chapter" data-level="7.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-2-examinar-los-datos"><i class="fa fa-check"></i><b>7.3</b> Paso 2: Examinar los datos</a></li>
<li class="chapter" data-level="7.4" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-3-limpiar-los-datos"><i class="fa fa-check"></i><b>7.4</b> Paso 3: Limpiar los datos</a><ul>
<li class="chapter" data-level="7.4.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#imputar-valores-faltantes"><i class="fa fa-check"></i><b>7.4.1</b> Imputar valores faltantes</a></li>
<li class="chapter" data-level="7.4.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#codificar-variables-categóricas"><i class="fa fa-check"></i><b>7.4.2</b> Codificar variables categóricas</a></li>
<li class="chapter" data-level="7.4.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#unificar-la-escala-de-las-variables-numéricas"><i class="fa fa-check"></i><b>7.4.3</b> Unificar la escala de las variables numéricas</a></li>
<li class="chapter" data-level="7.4.4" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#consolidar-todas-las-variables-generadas-ad-hoc-en-un-sólo-dataframe"><i class="fa fa-check"></i><b>7.4.4</b> Consolidar todas las variables generadas ad-hoc en un sólo dataframe</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-4-crear-sets-de-entrenamiento-y-de-testeo"><i class="fa fa-check"></i><b>7.5</b> Paso 4: Crear sets de entrenamiento y de testeo</a><ul>
<li class="chapter" data-level="7.5.1" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#paso-5-entrenar-y-testear-un-modelo"><i class="fa fa-check"></i><b>7.5.1</b> Paso 5: Entrenar y testear un modelo</a></li>
<li class="chapter" data-level="7.5.2" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#midiendo-la-performance-del-modelo-contra-datos-que-no-conoce"><i class="fa fa-check"></i><b>7.5.2</b> Midiendo la performance del modelo contra datos que no conoce</a></li>
<li class="chapter" data-level="7.5.3" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#comparando-performance"><i class="fa fa-check"></i><b>7.5.3</b> Comparando performance</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="machine-learning-en-una-aplicación-urbana.html"><a href="machine-learning-en-una-aplicación-urbana.html#ejercicios-5"><i class="fa fa-check"></i><b>7.6</b> Ejercicios</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analítica Urbana</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analizando-movimiento-el-flujo-de-viajes-urbanos" class="section level1">
<h1><span class="header-section-number">Capítulo 6</span> Analizando movimiento: el flujo de viajes urbanos</h1>
<p>Los sistemas urbanos se caracterizan por dinámicas continuas de flujo, como el viaje de las personas entre su lugar de trabajo y de residencia. Estas dinámicas son capturadas en diversas bases de datos con creciente grado de granularidad espacio-temporal. La disponibilidad de coordenadas precisas de origen y destino, combinada con la posibilidad de acceder a sistemas de ruteo en calles, nos permite estimar los trayectos realizado por personas y vehículos representados en bases de datos.</p>
<div id="estimando-rutas" class="section level2">
<h2><span class="header-section-number">6.1</span> Estimando rutas</h2>
<p>En general, los datos de flujo disponibles en datasets a escala metropolitana (en contraste con los datos personales como los de GPS) son simples pares origen/destino. Una ejemplo de datos abiertos de este tipo, es el de la ubicación e intercambio entre estaciones de sistemas de bicicletas compartidas.</p>
<p>Por ejemplo, el portal de datos abiertos de la <a href="https://data.buenosaires.gob.ar/datasets?query=bicicletas">Ciudad de Buenos Aires ofrece datasets con los trayectos realizados por los usuarios del sistema de bicicletas públicas, así como la ubicación de las estaciones</a>.</p>
<p>Si no lo hemos hecho aún, carguemos las librerías que vamos a necesitar.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb220-2" data-line-number="2"><span class="kw">library</span>(ggmap)</a></code></pre></div>
<p>Utilizaremos una porción de todos los trayectos disponibles, los que representan viajes en bicicletas públicas realizados durante el mes de abril de 2017:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1">viajes &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://bitsandbricks.github.io/data/viajes_BA_bici_abril_2017.csv&quot;</span>)</a>
<a class="sourceLine" id="cb221-2" data-line-number="2"></a>
<a class="sourceLine" id="cb221-3" data-line-number="3">viajes</a></code></pre></div>
<pre><code>## # A tibble: 113,650 x 6
##    HORA                ORIGEN_ESTACION NOMBRE_ORIGEN DESTINO_ESTACION
##    &lt;dttm&gt;                        &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;
##  1 2017-04-01 00:00:00               1 FACULTAD DE …               42
##  2 2017-04-01 00:00:00               5 PLAZA ITALIA                14
##  3 2017-04-01 00:00:00               5 PLAZA ITALIA                20
##  4 2017-04-01 00:00:00               5 PLAZA ITALIA                69
##  5 2017-04-01 00:00:00               5 PLAZA ITALIA                94
##  6 2017-04-01 00:00:00               5 PLAZA ITALIA               123
##  7 2017-04-01 00:00:00               6 PARQUE LEZAMA               17
##  8 2017-04-01 00:00:00               6 PARQUE LEZAMA               28
##  9 2017-04-01 00:00:00               6 PARQUE LEZAMA              118
## 10 2017-04-01 00:00:00               8 CONGRESO                     1
## # … with 113,640 more rows, and 2 more variables: NOMBRE_DESTINO &lt;chr&gt;,
## #   TOTAL &lt;dbl&gt;</code></pre>
<p>También descargamos un archivo de información geográfica con la posición de cada estación de bicicletas públicas:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">estaciones &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://bitsandbricks.github.io/data/estaciones_BA_bici.csv&quot;</span>)</a>
<a class="sourceLine" id="cb223-2" data-line-number="2"></a>
<a class="sourceLine" id="cb223-3" data-line-number="3">estaciones</a></code></pre></div>
<pre><code>## # A tibble: 199 x 10
##        X     Y NOMBRE  DOMICILIO IMAGEN AUTOMAT OBSERV NRO_EST HORARIO DIRE_NORM
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
##  1 -58.4 -34.6 FACULT… AV. PRES… ESTAC… AUTOMA… ABRIL…       1 ESTACI… FIGUEROA…
##  2 -58.4 -34.6 RETIRO  AV. DR.J… ESTAC… AUTOMA… ABRIL…       2 ESTACI… DEL LIBE…
##  3 -58.4 -34.6 ADUANA  AV. ING.… ESTAC… AUTOMA… ABRIL…       3 ESTACI… HUERGO, …
##  4 -58.4 -34.6 PLAZA … LAVALLE … ESTAC… AUTOMA… ABRIL…       4 ESTACI… LAVALLE …
##  5 -58.4 -34.6 PARQUE… AV MARTI… ESTAC… AUTOMA… ABRIL…       6 ESTACI… GARCIA, …
##  6 -58.4 -34.6 PLAZA … AV. SANT… ESTAC… AUTOMA… ABRIL…       5 ESTACI… SARMIENT…
##  7 -58.4 -34.6 OBELIS… AV. 9 DE… ESTAC… AUTOMA… ABRIL…       7 ESTACI… PELLEGRI…
##  8 -58.4 -34.6 CONGRE… AV. HIPO… ESTAC… AUTOMA… ABRIL…       8 ESTACI… YRIGOYEN…
##  9 -58.4 -34.6 PARQUE… PARQUE L… ESTAC… AUTOMA… ABRIL…       9 ESTACI… DIAZ, CN…
## 10 -58.4 -34.6 PUERTO… MOREAU D… ESTAC… AUTOMA… ABRIL…      10 ESTACI… 1500 MOR…
## # … with 189 more rows</code></pre>
<p>Ahora, las visualizamos.</p>
<p>Como preparativo obtenemos una “bounding box”, la caja de coordenadas que contiene todos los puntos:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1">bbox &lt;-<span class="st"> </span><span class="kw">make_bbox</span>(estaciones<span class="op">$</span>X, estaciones<span class="op">$</span>Y)</a>
<a class="sourceLine" id="cb225-2" data-line-number="2"></a>
<a class="sourceLine" id="cb225-3" data-line-number="3">bbox</a></code></pre></div>
<pre><code>##      left    bottom     right       top 
## -58.46000 -34.64541 -58.35132 -34.56439</code></pre>
<p>Ahora descargamos un mapa que abarca el rectángulo de nuestra bounding box</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">mapa_base &lt;-<span class="st"> </span><span class="kw">get_stamenmap</span>(bbox, <span class="dt">color =</span> <span class="st">&quot;bw&quot;</span>, <span class="dt">zoom =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb227-2" data-line-number="2"></a>
<a class="sourceLine" id="cb227-3" data-line-number="3"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb227-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> estaciones, <span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y), <span class="dt">color =</span> <span class="st">&quot;limegreen&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-185-1.png" width="672" /></p>
<p>Podemos ver que las estaciones del sistema se concentran en el centro económico de la ciudad y sus zonas aledañas. No tenemos un campo con la fecha de inauguración que nos permita saber el orden en que se desplegaron las estaciones, pero podemos usar el número que les fue asignado (asumiendo que respetan un orden cronológico) para aproximarlo:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb228-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> estaciones, <span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">color =</span> NRO_EST)) <span class="op">+</span></a>
<a class="sourceLine" id="cb228-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_color_distiller</span>(<span class="dt">type =</span> <span class="st">&quot;div&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-186-1.png" width="672" /></p>
<p>Si el número de estación refleja la antigüedad, pareciera que primero de desplegó un corredor desde el <em>downtown</em> hacia el noroeste, que luego se fue complementando con expansión radial.</p>
</div>
<div id="cuantificando-interacción" class="section level2">
<h2><span class="header-section-number">6.2</span> Cuantificando interacción</h2>
<p>A partir de ahora, agreguemos <code>theme_nothing()</code> para retirar todos los componentes auxiliares (como escalas y leyendas) y quedarnos solo con el mapa.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> estaciones, <span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y), <span class="dt">color =</span> <span class="st">&quot;limegreen&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb229-3" data-line-number="3"><span class="st">    </span><span class="kw">theme_nothing</span>()</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-187-1.png" width="672" /></p>
<p>A continuación, realizamos un conteo de trayectos entre pares de estaciones</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">conteo &lt;-<span class="st"> </span>viajes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-2" data-line-number="2"><span class="st">    </span><span class="kw">group_by</span>(ORIGEN_ESTACION, DESTINO_ESTACION) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-3" data-line-number="3"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>(TOTAL))</a></code></pre></div>
<p>Podemos evaluar el grado de interconexión haciendo un <em>heatmap</em>, un mapa de calor que muestre la cantidad de viajes entre pares de estaciones. Hacemos uso de <code>geom_tile()</code> una geometría de <code>ggplot()</code> que genera rectángulos.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> conteo, <span class="kw">aes</span>(<span class="dt">x =</span> ORIGEN_ESTACION, <span class="dt">y =</span> DESTINO_ESTACION, <span class="dt">fill =</span> total)) <span class="op">+</span></a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-189-1.png" width="672" /></p>
<p>El gráfico revela una característica de los datos: la numeración de la estaciones es discontinua. Crece secuencialmente hasta casi 200, pero por alguna razón hay un par de estaciones numeradas por encima de 500. Lo verificamos:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="kw">unique</span>(conteo<span class="op">$</span>ORIGEN_ESTACION)</a></code></pre></div>
<pre><code>##   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  16  17  18  19
##  [19]  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37
##  [37]  38  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56
##  [55]  57  58  59  60  61  62  63  64  65  66  68  69  70  71  72  73  74  75
##  [73]  76  77  79  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95
##  [91]  96  98  99 100 101 103 104 105 106 108 109 110 111 112 113 114 115 118
## [109] 119 120 121 122 123 124 126 128 129 132 134 135 136 138 139 140 144 145
## [127] 146 149 150 151 152 153 154 158 160 161 164 166 167 172 173 175 176 181
## [145] 191 502 505</code></pre>
<p>Podemos evitar el hueco que aparece en el mapa de calor tratando a las estaciones como una variable categórica (un factor) en lugar de numérica</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> conteo, </a>
<a class="sourceLine" id="cb234-3" data-line-number="3">              <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(ORIGEN_ESTACION),</a>
<a class="sourceLine" id="cb234-4" data-line-number="4">                  <span class="dt">y =</span> <span class="kw">as.factor</span>(DESTINO_ESTACION),</a>
<a class="sourceLine" id="cb234-5" data-line-number="5">                  <span class="dt">fill =</span> total)) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-6" data-line-number="6"><span class="st">    </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
<p>La visualización es difícil de leer, pero aún así revela patrones. El tipo de viaje más popular es el de tomar y dejar la bicicleta en la misma estación, sugiriendo la prevalencia del uso recreativo. La interacción entre estaciones más alta se da entre las que tienen los primeros números, que como hemos visto se localizan en el centro de la ciudad. Las cantidad de combinaciones posibles crece rapidísimo con el número de nodos, por eso las interacción en redes grandes es difícil de visualizar.</p>
<p>Para continuar, tomemos sólo los 10 trayectos más frecuentes, descartando los viajes “circulares” (con el mismo origen y destino):</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">top10 &lt;-<span class="st"> </span>conteo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-2" data-line-number="2"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(ORIGEN_ESTACION <span class="op">!=</span><span class="st"> </span>DESTINO_ESTACION) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-4" data-line-number="4"><span class="st">    </span><span class="kw">top_n</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb235-5" data-line-number="5"></a>
<a class="sourceLine" id="cb235-6" data-line-number="6">top10</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    ORIGEN_ESTACION DESTINO_ESTACION total
##              &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;
##  1               1                2   333
##  2               1               44   146
##  3               2                1   311
##  4               2               10   181
##  5               2              164   115
##  6               9               44   121
##  7              10                2   182
##  8              30                9   118
##  9              44                1   176
## 10              44               14   127</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb237-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> top10, </a>
<a class="sourceLine" id="cb237-3" data-line-number="3">              <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(ORIGEN_ESTACION),</a>
<a class="sourceLine" id="cb237-4" data-line-number="4">                  <span class="dt">y =</span> <span class="kw">as.factor</span>(DESTINO_ESTACION),</a>
<a class="sourceLine" id="cb237-5" data-line-number="5">                  <span class="dt">fill =</span> total)) <span class="op">+</span></a>
<a class="sourceLine" id="cb237-6" data-line-number="6"><span class="st">    </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>Como se vislumbra en el heatmap completo, la interacción entre las estaciones 1 y 2 es con diferencia la más frecuente.</p>
</div>
<div id="estimando-rutas-1" class="section level2">
<h2><span class="header-section-number">6.3</span> Estimando rutas</h2>
<p>Para trazar los trayectos de los usuarios al viajar de una estación a otra, no tendría sentido tender líneas rectas entre origen y destino. Para visualizar el tránsito, necesitamos tener en cuenta la ubicación de las calles y la dirección de tráfico que permiten. Lo ideal sería poder representar la ruta exacta de cada trayecto, sabiendo cuáles fueron las calles transitadas para realizar el viaje. Cuando no disponemos de información con ese nivel de detalle, lo que podemos hacer es estimar los recorridos utilizando un servicio de ruteo como el de Google Maps, o el del proyecto <a href="http://map.project-osrm.org/">OSRM</a>.</p>
<p>En R contamos con paquetes especializados para conectar con estos servicios y trabajar con información de ruteo. El paquete <code>googleway()</code> permite conectar R con la API de Google Maps, y <code>osrm</code> hace lo propio con OSRM.</p>
<p>Vamos con OSRM. Si no tenemos el paquete necesario, lo instalamos.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;osrm&quot;</span>)</a></code></pre></div>
<p>Y lo activamos:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1"><span class="kw">library</span>(osrm)</a></code></pre></div>
<p>Para poder recibir información de ruteo desde los servidores de Google, la compañía exige el uso de una <em>API key</em>, una clave de autorización. Tal como con Twitter, el proceso de adquirir una clave es instantáneo, pero desde mediados de 2018 Google entrega API key sólo a usuarios que brinden información de una tarjeta de crédito, para cobrar el uso que supere ciertos umbrales.</p>
<p>Para quienes deseen hacer uso de las múltiples funciones que Google ofrece a través de sus APIs, la molestia vale la pena, y puede seguir éstos pasos: <a href="https://developers.google.com/maps/documentation/directions/get-api-key" class="uri">https://developers.google.com/maps/documentation/directions/get-api-key</a>.</p>
<p>Para resolver el problema del ejercicio, nosotros optaremos por el ruteo vía OSRM que no requiere permiso ni tarjetas de crédito.</p>
<p>Para encontrar una ruta, usamos la función <code>osrmRoute</code>, que requiere origen y destino en forma de vectores conteniendo un identificador (nombre del lugar o posición), longitud y latitud. Por ejemplo, para rutear entre dos lugares en Buenos Aires como Parque Centenario y la Estación Retiro:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">pcentenario &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">nombre =</span> <span class="st">&quot;Parque Centenario&quot;</span>,</a>
<a class="sourceLine" id="cb240-2" data-line-number="2">                 <span class="dt">lon =</span> <span class="fl">-58.435609</span>,</a>
<a class="sourceLine" id="cb240-3" data-line-number="3">                 <span class="dt">lat =</span> <span class="fl">-34.606411</span>)</a>
<a class="sourceLine" id="cb240-4" data-line-number="4"></a>
<a class="sourceLine" id="cb240-5" data-line-number="5">eretiro &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">nombre =</span> <span class="st">&quot;Estación Retiro&quot;</span>,</a>
<a class="sourceLine" id="cb240-6" data-line-number="6">             <span class="dt">lon =</span> <span class="fl">-58.374873</span>,</a>
<a class="sourceLine" id="cb240-7" data-line-number="7">             <span class="dt">lat =</span> <span class="fl">-34.591394</span>)</a>
<a class="sourceLine" id="cb240-8" data-line-number="8"></a>
<a class="sourceLine" id="cb240-9" data-line-number="9">centenario_a_retiro &lt;-<span class="st"> </span><span class="kw">osrmRoute</span>(<span class="dt">src =</span> pcentenario, </a>
<a class="sourceLine" id="cb240-10" data-line-number="10">                                 <span class="dt">dst =</span> eretiro, </a>
<a class="sourceLine" id="cb240-11" data-line-number="11">                                 <span class="dt">returnclass =</span>  <span class="st">&quot;sf&quot;</span>, </a>
<a class="sourceLine" id="cb240-12" data-line-number="12">                                 <span class="dt">overview =</span> <span class="st">&quot;full&quot;</span>)</a></code></pre></div>
<p>La opción <code>returnclass = &quot;sf&quot;</code> permite obtener un dataframe espacial como resultado, que podemos proyectar luego sobre un mapa. <code>overview = &quot;full&quot;</code> hace que <code>osrmRoute</code> calcule la ruta precisa (con posiciones exactas) en lugar de un aproximado; de nuevo, solicitamos esto para luego poder visualizar el camino exacto en un mapa.</p>
<p><code>osrmRoute</code> también estima la duración (en minutos) y la distancia (en kilómetros) del trayecto, como se ve en los campos “duration” y “distance”:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">centenario_a_retiro</a></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 4 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -58.43689 ymin: -34.60636 xmax: -58.37422 ymax: -34.59099
## CRS:            EPSG:4326
##                                                 src             dst duration
## Parque Centenario_Estación Retiro Parque Centenario Estación Retiro 84.83333
##                                   distance                       geometry
## Parque Centenario_Estación Retiro   6.9386 LINESTRING (-58.43598 -34.6...</code></pre>
<p>Podemos revisar rápidamente la ruta hallada usando <code>leaflet</code>:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1"><span class="kw">library</span>(leaflet)</a>
<a class="sourceLine" id="cb243-2" data-line-number="2"></a>
<a class="sourceLine" id="cb243-3" data-line-number="3"><span class="kw">leaflet</span>(centenario_a_retiro) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-4" data-line-number="4"><span class="st">    </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-5" data-line-number="5"><span class="st">    </span><span class="kw">addPolylines</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-50681e10470cc29ff925" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-50681e10470cc29ff925">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[-58.43598,-58.43598,-58.43604,-58.43611,-58.43622,-58.43622,-58.43635,-58.43636,-58.43637,-58.43636,-58.4363,-58.43622,-58.43618,-58.43615,-58.43624,-58.43637,-58.43648,-58.43689,-58.43666,-58.4365,-58.43638,-58.4364,-58.43652,-58.43515,-58.43495,-58.43475,-58.43389,-58.43332,-58.43314,-58.43229,-58.43213,-58.43186,-58.4317,-58.43151,-58.43112,-58.43104,-58.43036,-58.43023,-58.43016,-58.43009,-58.42966,-58.42923,-58.42916,-58.42852,-58.42798,-58.42688,-58.42677,-58.42658,-58.42644,-58.42623,-58.42496,-58.42466,-58.42462,-58.42383,-58.42374,-58.42366,-58.42356,-58.42348,-58.42336,-58.42316,-58.42305,-58.42296,-58.42291,-58.42284,-58.42277,-58.42176,-58.42149,-58.4212,-58.42088,-58.42066,-58.42017,-58.41895,-58.41727,-58.41714,-58.41598,-58.41462,-58.41437,-58.41326,-58.41312,-58.41191,-58.41028,-58.4102,-58.40942,-58.40816,-58.40805,-58.40664,-58.40655,-58.40559,-58.40557,-58.40518,-58.40401,-58.40386,-58.40365,-58.40345,-58.40209,-58.4013,-58.40067,-58.39903,-58.39886,-58.39872,-58.39854,-58.3983,-58.39787,-58.39756,-58.39754,-58.39735,-58.39589,-58.39455,-58.39337,-58.39305,-58.39274,-58.3922,-58.39167,-58.39117,-58.39102,-58.38973,-58.38821,-58.38697,-58.38555,-58.38412,-58.3841,-58.38375,-58.38356,-58.3835,-58.3835,-58.38351,-58.38351,-58.38351,-58.3835,-58.3835,-58.38349,-58.38348,-58.38346,-58.38344,-58.38343,-58.38336,-58.38318,-58.38284,-58.38279,-58.38268,-58.38269,-58.38231,-58.38214,-58.38208,-58.38197,-58.38185,-58.38155,-58.38145,-58.38147,-58.38147,-58.38148,-58.38101,-58.38092,-58.38084,-58.38081,-58.38066,-58.38062,-58.38049,-58.38035,-58.38025,-58.37995,-58.37885,-58.37851,-58.37835,-58.37825,-58.37816,-58.37802,-58.37792,-58.37785,-58.37785,-58.37785,-58.37782,-58.37776,-58.37767,-58.37764,-58.37758,-58.37751,-58.37741,-58.37726,-58.377,-58.37693,-58.37578,-58.37569,-58.37562,-58.37527,-58.37525,-58.37523,-58.37531,-58.37496,-58.37485,-58.37475,-58.37463,-58.37459,-58.37426,-58.37424,-58.37422,-58.37427,-58.37458,-58.37466,-58.37473],"lat":[-34.60636,-34.60634,-34.60628,-34.60629,-34.60635,-34.60635,-34.60631,-34.60627,-34.60622,-34.60616,-34.6061,-34.60606,-34.60603,-34.606,-34.60594,-34.60571,-34.60543,-34.60459,-34.6045,-34.60447,-34.60445,-34.60442,-34.60428,-34.60359,-34.6035,-34.6034,-34.60295,-34.60269,-34.60259,-34.60214,-34.60204,-34.60173,-34.60154,-34.60132,-34.60087,-34.60077,-34.59999,-34.59984,-34.59977,-34.5997,-34.59935,-34.59898,-34.59893,-34.59865,-34.59842,-34.59798,-34.59794,-34.5979,-34.59789,-34.59788,-34.59786,-34.59785,-34.59785,-34.59782,-34.59782,-34.59781,-34.5978,-34.59778,-34.59775,-34.59773,-34.59771,-34.59771,-34.59771,-34.5977,-34.59771,-34.59773,-34.59774,-34.59774,-34.59775,-34.59776,-34.59776,-34.5978,-34.59784,-34.59784,-34.59786,-34.59791,-34.59792,-34.59796,-34.59797,-34.59803,-34.59812,-34.59812,-34.59811,-34.59808,-34.59808,-34.59807,-34.59807,-34.59806,-34.59801,-34.59724,-34.59745,-34.59748,-34.59752,-34.59755,-34.59778,-34.59792,-34.59803,-34.59832,-34.59835,-34.59838,-34.59841,-34.59846,-34.59852,-34.59857,-34.59857,-34.5986,-34.59872,-34.59871,-34.59872,-34.59871,-34.59869,-34.59866,-34.59863,-34.59859,-34.59858,-34.59849,-34.59839,-34.5983,-34.5982,-34.5981,-34.59803,-34.5977,-34.59753,-34.59747,-34.59747,-34.59745,-34.59744,-34.59742,-34.59741,-34.59741,-34.5974,-34.5974,-34.59739,-34.5974,-34.5974,-34.59734,-34.59718,-34.59687,-34.59682,-34.59681,-34.59669,-34.59666,-34.59665,-34.59665,-34.59664,-34.59664,-34.59661,-34.59606,-34.59558,-34.59552,-34.59537,-34.59535,-34.59534,-34.59533,-34.59533,-34.59532,-34.59532,-34.59531,-34.59531,-34.5953,-34.59527,-34.59519,-34.59516,-34.59514,-34.59513,-34.59512,-34.5951,-34.59508,-34.59508,-34.59502,-34.59497,-34.59488,-34.59476,-34.59463,-34.59459,-34.59453,-34.59449,-34.59445,-34.59438,-34.59444,-34.59442,-34.59304,-34.59292,-34.59288,-34.59276,-34.59251,-34.59245,-34.59241,-34.59198,-34.59184,-34.59171,-34.59155,-34.5915,-34.5911,-34.59109,-34.5911,-34.59116,-34.59099,-34.5911,-34.59119]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-34.60636,-34.59099],"lng":[-58.43689,-58.37422]}},"evals":[],"jsHooks":[]}</script>
<p>Ahora, lo intentamos con los datos de viajes en bicicleta. Hacemos un <em>join</em> del dataframe con el conteo de viajes contra el de posición de estaciones, para agregar las coordenadas.</p>
<p>De origen:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">top10 &lt;-<span class="st"> </span>top10 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-2" data-line-number="2"><span class="st">    </span><span class="kw">left_join</span>(estaciones[<span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;NOMBRE&quot;</span>, <span class="st">&quot;NRO_EST&quot;</span>)], </a>
<a class="sourceLine" id="cb244-3" data-line-number="3">              <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ORIGEN_ESTACION&quot;</span> =<span class="st"> &quot;NRO_EST&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">ORIGEN_X =</span> X,</a>
<a class="sourceLine" id="cb244-5" data-line-number="5">           <span class="dt">ORIGEN_Y =</span> Y,</a>
<a class="sourceLine" id="cb244-6" data-line-number="6">           <span class="dt">ORIGEN_NOMBRE =</span> NOMBRE)</a>
<a class="sourceLine" id="cb244-7" data-line-number="7"></a>
<a class="sourceLine" id="cb244-8" data-line-number="8">top10</a></code></pre></div>
<pre><code>## # A tibble: 10 x 6
##    ORIGEN_ESTACION DESTINO_ESTACION total ORIGEN_X ORIGEN_Y ORIGEN_NOMBRE      
##              &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;              
##  1               1                2   333    -58.4    -34.6 FACULTAD DE DERECHO
##  2               1               44   146    -58.4    -34.6 FACULTAD DE DERECHO
##  3               2                1   311    -58.4    -34.6 RETIRO             
##  4               2               10   181    -58.4    -34.6 RETIRO             
##  5               2              164   115    -58.4    -34.6 RETIRO             
##  6               9               44   121    -58.4    -34.6 PARQUE LAS HERAS   
##  7              10                2   182    -58.4    -34.6 PUERTO MADERO - UCA
##  8              30                9   118    -58.4    -34.6 PEÑA               
##  9              44                1   176    -58.4    -34.6 ZOOLOGICO          
## 10              44               14   127    -58.4    -34.6 ZOOLOGICO</code></pre>
<p>Y además las de destino:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">top10 &lt;-<span class="st"> </span>top10 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-2" data-line-number="2"><span class="st">    </span><span class="kw">left_join</span>(estaciones[<span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;NOMBRE&quot;</span>, <span class="st">&quot;NRO_EST&quot;</span>)], </a>
<a class="sourceLine" id="cb246-3" data-line-number="3">              <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;DESTINO_ESTACION&quot;</span> =<span class="st"> &quot;NRO_EST&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-4" data-line-number="4"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">DESTINO_X =</span> X,</a>
<a class="sourceLine" id="cb246-5" data-line-number="5">           <span class="dt">DESTINO_Y =</span> Y,</a>
<a class="sourceLine" id="cb246-6" data-line-number="6">           <span class="dt">DESTINO_NOMBRE =</span> NOMBRE)</a>
<a class="sourceLine" id="cb246-7" data-line-number="7"></a>
<a class="sourceLine" id="cb246-8" data-line-number="8">top10</a></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    ORIGEN_ESTACION DESTINO_ESTACION total ORIGEN_X ORIGEN_Y ORIGEN_NOMBRE
##              &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        
##  1               1                2   333    -58.4    -34.6 FACULTAD DE …
##  2               1               44   146    -58.4    -34.6 FACULTAD DE …
##  3               2                1   311    -58.4    -34.6 RETIRO       
##  4               2               10   181    -58.4    -34.6 RETIRO       
##  5               2              164   115    -58.4    -34.6 RETIRO       
##  6               9               44   121    -58.4    -34.6 PARQUE LAS H…
##  7              10                2   182    -58.4    -34.6 PUERTO MADER…
##  8              30                9   118    -58.4    -34.6 PEÑA         
##  9              44                1   176    -58.4    -34.6 ZOOLOGICO    
## 10              44               14   127    -58.4    -34.6 ZOOLOGICO    
## # … with 3 more variables: DESTINO_X &lt;dbl&gt;, DESTINO_Y &lt;dbl&gt;,
## #   DESTINO_NOMBRE &lt;chr&gt;</code></pre>
<p>Probemos rutear el trayecto más popular, el de Facultad de Derecho a Retiro:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">viaje &lt;-<span class="st"> </span>top10[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb248-2" data-line-number="2"></a>
<a class="sourceLine" id="cb248-3" data-line-number="3">fderecho_a_retiro &lt;-<span class="st"> </span><span class="kw">osrmRoute</span>(<span class="dt">src =</span> <span class="kw">c</span>(viaje<span class="op">$</span>ORIGEN_NOMBRE, viaje<span class="op">$</span>ORIGEN_X, viaje<span class="op">$</span>ORIGEN_Y), </a>
<a class="sourceLine" id="cb248-4" data-line-number="4">                                 <span class="dt">dst =</span> <span class="kw">c</span>(viaje<span class="op">$</span>DESTINO_NOMBRE, viaje<span class="op">$</span>DESTINO_X, viaje<span class="op">$</span>DESTINO_Y), </a>
<a class="sourceLine" id="cb248-5" data-line-number="5">                                 <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>, </a>
<a class="sourceLine" id="cb248-6" data-line-number="6">                                 <span class="dt">overview =</span> <span class="st">&quot;full&quot;</span>)</a>
<a class="sourceLine" id="cb248-7" data-line-number="7"></a>
<a class="sourceLine" id="cb248-8" data-line-number="8">fderecho_a_retiro</a></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 4 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -58.39231 ymin: -34.59263 xmax: -58.37486 ymax: -34.58301
## CRS:            EPSG:4326
##                                            src    dst duration distance
## FACULTAD DE DERECHO_RETIRO FACULTAD DE DERECHO RETIRO 24.15667    2.002
##                                                  geometry
## FACULTAD DE DERECHO_RETIRO LINESTRING (-58.39231 -34.5...</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1"><span class="kw">leaflet</span>(fderecho_a_retiro) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="st">    </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-3" data-line-number="3"><span class="st">    </span><span class="kw">addPolylines</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-277a94f97c18a5ff7d71" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-277a94f97c18a5ff7d71">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[-58.39231,-58.39219,-58.39165,-58.39162,-58.39159,-58.39153,-58.39155,-58.39133,-58.39128,-58.39123,-58.39111,-58.39101,-58.39028,-58.39021,-58.39002,-58.38928,-58.38915,-58.38921,-58.38913,-58.38865,-58.38771,-58.38737,-58.38728,-58.3865,-58.38594,-58.38564,-58.38553,-58.38551,-58.38535,-58.38457,-58.3844,-58.38425,-58.38398,-58.38311,-58.38191,-58.3795,-58.37943,-58.37928,-58.37913,-58.37903,-58.37892,-58.37863,-58.37786,-58.37771,-58.37666,-58.3765,-58.37632,-58.3762,-58.37588,-58.37585,-58.37555,-58.37551,-58.37543,-58.37537,-58.37531,-58.37523,-58.37517,-58.3751,-58.37503,-58.37497,-58.3749,-58.37486],"lat":[-34.58319,-34.58301,-34.58327,-34.58327,-34.58326,-34.58353,-34.58355,-34.58364,-34.58368,-34.58371,-34.58377,-34.58379,-34.58411,-34.58421,-34.58428,-34.58462,-34.58467,-34.5848,-34.58483,-34.58507,-34.58555,-34.58583,-34.58587,-34.58626,-34.58634,-34.58643,-34.58649,-34.5865,-34.58657,-34.58692,-34.58701,-34.58711,-34.58731,-34.58778,-34.58846,-34.58978,-34.58983,-34.58994,-34.59007,-34.59016,-34.59027,-34.5906,-34.59112,-34.59122,-34.59189,-34.5918,-34.5919,-34.59194,-34.59215,-34.5922,-34.59237,-34.5924,-34.59244,-34.59245,-34.59241,-34.59245,-34.59248,-34.59252,-34.59256,-34.59259,-34.59263,-34.59257]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-34.59263,-34.58301],"lng":[-58.39231,-58.37486]}},"evals":[],"jsHooks":[]}</script>
<p>Si queremos ver el trayecto en un mapa estático, podemos usar <code>ggmap()</code> con <code>geom_sf()</code>:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> estaciones, <span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y), <span class="dt">color =</span> <span class="st">&quot;limegreen&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> fderecho_a_retiro, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb251-4" data-line-number="4"><span class="st">    </span><span class="kw">theme_nothing</span>()</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-206-1.png" width="672" /></p>
<p>Calcular todos los recorridos y juntarlos en un sólo dataframe puede ser muy fácil o bastante engorroso, dependiendo de cuanta práctica tengamos en la automatización de tareas repetitivas. Por lo pronto, podemos descargar un dataset ya calculado con los recorridos detallados entre todas las estaciones de nuestro top 10:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">recorridos &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;https://bitsandbricks.github.io/data/recorridos_BA_bici.geojson&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `recorridos_BA_bici&#39; from data source `https://bitsandbricks.github.io/data/recorridos_BA_bici.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 10 features and 6 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -58.42635 ymin: -34.62158 xmax: -58.36573 ymax: -34.5627
## CRS:            4326</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1">recorridos</a></code></pre></div>
<pre><code>## Simple feature collection with 10 features and 6 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -58.42635 ymin: -34.62158 xmax: -58.36573 ymax: -34.5627
## CRS:            4326
##    ORIGEN_ESTACION DESTINO_ESTACION src dst  duration distance
## 1                1                2   1   2 16.005000   5.4228
## 2                1               44   1  44  6.741667   2.7496
## 3                2                1   2   1  7.198333   2.3073
## 4                2               10   2  10 10.708333   3.8060
## 5                2              164   2 164 11.688333   4.3380
## 6                9               44   9  44  8.775000   2.8171
## 7               10                2  10   2 11.023333   3.4170
## 8               30                9  30   9  7.986667   2.0258
## 9               44                1  44   1 13.831667   7.8749
## 10              44               14  44  14  8.278333   2.4001
##                          geometry
## 1  LINESTRING (-58.39256 -34.5...
## 2  LINESTRING (-58.39256 -34.5...
## 3  LINESTRING (-58.37493 -34.5...
## 4  LINESTRING (-58.37493 -34.5...
## 5  LINESTRING (-58.37493 -34.5...
## 6  LINESTRING (-58.40661 -34.5...
## 7  LINESTRING (-58.36598 -34.6...
## 8  LINESTRING (-58.39733 -34.5...
## 9  LINESTRING (-58.41484 -34.5...
## 10 LINESTRING (-58.41484 -34.5...</code></pre>
<p>Los que quieran espiar un método para compilar los recorrido por su cuenta, puede verlo al final del documento.</p>
<p>Para poder asignar un color a cada recorrido, creamos un identificador único para diferenciarlos</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">recorridos &lt;-<span class="st"> </span>recorridos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb256-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">ID =</span> <span class="kw">paste</span>(ORIGEN_ESTACION, <span class="st">&quot;-&quot;</span>, DESTINO_ESTACION))</a></code></pre></div>
<p>Y ahora, al mapa:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> recorridos, <span class="kw">aes</span>(<span class="dt">color =</span> ID), <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb257-3" data-line-number="3"><span class="st">    </span><span class="kw">theme_nothing</span>()</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<p>Si queremos que el grosor de la línea represente la cantidad de veces que se realizó cada recorrido, primero agregamos la cantidad de viajes por recorrido, mediante el cruce con los datos que calculamos en “conteo”:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1">recorridos &lt;-<span class="st"> </span>recorridos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb258-2" data-line-number="2"><span class="st">    </span><span class="kw">left_join</span>(conteo)</a></code></pre></div>
<p>Y luego los usamos en el mapa:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base) <span class="op">+</span></a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> recorridos, <span class="kw">aes</span>(<span class="dt">color =</span> ID, <span class="dt">size =</span> total), <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">    </span><span class="kw">theme_nothing</span>()</a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-211-1.png" width="672" /></p>
<p>También podemos usar el color para indicar el volumen de viajes:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1"><span class="kw">ggmap</span>(mapa_base, <span class="dt">darken =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> recorridos, <span class="kw">aes</span>(<span class="dt">color =</span> total, <span class="dt">group =</span> ID), </a>
<a class="sourceLine" id="cb260-3" data-line-number="3">              <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb260-4" data-line-number="4">              <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-5" data-line-number="5"><span class="st">    </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;inferno&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-6" data-line-number="6"><span class="st">    </span><span class="kw">theme_nothing</span>() </a></code></pre></div>
<p><img src="analitica_urbana_files/figure-html/unnamed-chunk-212-1.png" width="672" /></p>
</div>
<div id="extra-cómo-obtener-las-rutas-de-todos-los-recorridos" class="section level2">
<h2><span class="header-section-number">6.4</span> EXTRA: Cómo obtener las rutas de todos los recorridos</h2>
<p>Tras leer el capítulo de 21 de R for Data Science, <a href="http://r4ds.had.co.nz/iteration.html">“iteration”</a>, ésto debería tener sentido:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">obtener_recorrido &lt;-<span class="st"> </span><span class="cf">function</span>(o_nombre, o_x, o_y, d_nombre, d_x, d_y) {</a>
<a class="sourceLine" id="cb261-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb261-3" data-line-number="3">    ruta &lt;-<span class="st"> </span><span class="kw">osrmRoute</span>(<span class="dt">src =</span> <span class="kw">c</span>(o_nombre, o_x, o_y),</a>
<a class="sourceLine" id="cb261-4" data-line-number="4">                      <span class="dt">dst =</span> <span class="kw">c</span>(d_nombre, d_x, d_y),</a>
<a class="sourceLine" id="cb261-5" data-line-number="5">                      <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</a>
<a class="sourceLine" id="cb261-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb261-7" data-line-number="7">    <span class="kw">cbind</span>(<span class="dt">ORIGEN_ESTACION =</span> o_nombre, <span class="dt">DESTINO_ESTACION =</span> d_nombre, ruta)</a>
<a class="sourceLine" id="cb261-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb261-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb261-10" data-line-number="10"></a>
<a class="sourceLine" id="cb261-11" data-line-number="11"></a>
<a class="sourceLine" id="cb261-12" data-line-number="12">argumentos &lt;-<span class="st"> </span><span class="kw">list</span>(top10<span class="op">$</span>ORIGEN_ESTACION, top10<span class="op">$</span>ORIGEN_X, top10<span class="op">$</span>ORIGEN_Y,</a>
<a class="sourceLine" id="cb261-13" data-line-number="13">                  top10<span class="op">$</span>DESTINO_ESTACION, top10<span class="op">$</span>DESTINO_X, top10<span class="op">$</span>DESTINO_Y)</a>
<a class="sourceLine" id="cb261-14" data-line-number="14"></a>
<a class="sourceLine" id="cb261-15" data-line-number="15">recorridos &lt;-<span class="st"> </span><span class="kw">pmap</span>(argumentos, obtener_recorrido)</a>
<a class="sourceLine" id="cb261-16" data-line-number="16"></a>
<a class="sourceLine" id="cb261-17" data-line-number="17">recorridos &lt;-<span class="st"> </span><span class="kw">reduce</span>(recorridos, rbind)</a></code></pre></div>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1">recorridos</a></code></pre></div>
<pre><code>## Simple feature collection with 10 features and 8 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -58.42635 ymin: -34.62158 xmax: -58.36573 ymax: -34.5627
## CRS:            4326
##    ORIGEN_ESTACION DESTINO_ESTACION src dst  duration distance      ID total
## 1                1                2   1   2 16.005000   5.4228   1 - 2   333
## 2                1               44   1  44  6.741667   2.7496  1 - 44   146
## 3                2                1   2   1  7.198333   2.3073   2 - 1   311
## 4                2               10   2  10 10.708333   3.8060  2 - 10   181
## 5                2              164   2 164 11.688333   4.3380 2 - 164   115
## 6                9               44   9  44  8.775000   2.8171  9 - 44   121
## 7               10                2  10   2 11.023333   3.4170  10 - 2   182
## 8               30                9  30   9  7.986667   2.0258  30 - 9   118
## 9               44                1  44   1 13.831667   7.8749  44 - 1   176
## 10              44               14  44  14  8.278333   2.4001 44 - 14   127
##                          geometry
## 1  LINESTRING (-58.39256 -34.5...
## 2  LINESTRING (-58.39256 -34.5...
## 3  LINESTRING (-58.37493 -34.5...
## 4  LINESTRING (-58.37493 -34.5...
## 5  LINESTRING (-58.37493 -34.5...
## 6  LINESTRING (-58.40661 -34.5...
## 7  LINESTRING (-58.36598 -34.6...
## 8  LINESTRING (-58.39733 -34.5...
## 9  LINESTRING (-58.41484 -34.5...
## 10 LINESTRING (-58.41484 -34.5...</code></pre>
</div>
<div id="ejercicios-4" class="section level2">
<h2><span class="header-section-number">6.5</span> Ejercicios</h2>
<p><strong>Analizando y visualizando flujos de viajes urbanos</strong></p>
<p>I. Elegir alguna de las siguientes opciones:</p>
<ol style="list-style-type: lower-alpha">
<li>Un dataset que contenga viajes origen-destino (por ejemplo bicicletas públicas) de la Ciudad con la que están trabajando.</li>
<li>Un dataset que contenga servicios esenciales (hospitales, escuelas, comisarías, etc) de la Ciudad con la que están trabajando. En este caso deberán elegir un barrio céntrico y uno periférico del shape de barrios y calcular ambos centroides.
Los datos pueden ser descargados del portal open data de la ciudad o de OSM y deben tener ubicación geográfica.</li>
</ol>
<ol start="2" style="list-style-type: upper-roman">
<li>Según la opción elegida en el punto I, resolver:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Viajes origen-destino: Analizar la cantidad de viajes entre los puntos a partir de un mapa de calor (heatmap) y calcular los 10 recorridos más realizados. Describir los resultados obtenidos y hacer el siguiente mapa:</li>
</ol>
<ul>
<li>Mapa con los ruteos de los 10 recorridos más realizados.</li>
</ul>
<ol start="2" style="list-style-type: lower-alpha">
<li>Servicios esenciales: Estimar la distancia entre los centroides calculados en el punto I y los ítems que componen la capa descargada. Describir los resultados obtenidos y hacer los siguientes mapas:</li>
</ol>
<ul>
<li>Mapa con los ruteos del centroide del barrio céntrico a los ítems de servicios esenciales elegido.</li>
<li>Mapa con los ruteos del centroide del barrio periférico a los ítems de servicios esenciales elegido.</li>
</ul>
<p>Consejos:
Si bajamos datos de OpenStreetMap -por ejemplo, escuelas de una ciudad- los obetenemos en formato <code>sf</code>.
Un dataframe <code>sf</code> tiene sus coordenadas en una sola columna, llamada “geometry”. Pero que pasa si queremos los datos en dos columnas, lat y long, para aprovechar los ejemplos de funciones de ruteo que hemos visto? Muy simple.</p>
<p>Si su dataframe en formato sf se llama “misdatos”, así es como obtienen columnas con lat y long:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">misdatos &lt;-<span class="st"> </span>misdatos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lat =</span> <span class="kw">unlist</span>(<span class="kw">map</span>(misdatos<span class="op">$</span>geometry,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb264-3" data-line-number="3">           <span class="dt">long =</span> <span class="kw">unlist</span>(<span class="kw">map</span>(misdatos<span class="op">$</span>geometry,<span class="dv">2</span>)))</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analizando-dinámicas-espacio-temporales.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="machine-learning-en-una-aplicación-urbana.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["analitica_urbana.pdf", "analitica_urbana.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
